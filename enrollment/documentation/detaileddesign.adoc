= Detailed Design Documentation

== Class-by-Class Analysis

=== EnrollmentApplication

Purpose:
- Main class for the Spring Boot application.

Methods:
- `public static void main(String[] args)`: Entry point for the application.

Annotations:
- `@EnableFeignClients`: Enables Feign clients for REST communication.
- `@SpringBootApplication`: Indicates this class is the main Spring Boot application class.

Design Patterns:
- No specific design patterns used.

=== UserManagementClient

Purpose:
- Feign client for interacting with the User Management service.

Annotations:
- `@FeignClient`: Marks the interface as a Feign client.
- `@GetMapping`, `@RequestParam`: Define the HTTP methods and parameters for the client.

Design Patterns:
- No specific design patterns used.

=== EnrollmentController

Purpose:
- REST controller for handling enrollment-related requests.

Methods:
- `public String nominatePrimary(@RequestParam String username)`: Handles nomination of a primary user.
- `public String nominatePrimarygreet()`: Sample method for greeting.

Annotations:
- `@Autowired`, `@PostMapping`, `@RequestMapping`, `@RequestParam`, `@RestController`: Annotations for dependency injection and REST mapping.

Design Patterns:
- No specific design patterns used.

=== UserResponseDTO

Purpose:
- Data Transfer Object (DTO) for user responses.

Annotations:
- `@Getter`, `@Setter`: Lombok annotations for generating getters and setters.

Design Patterns:
- No specific design patterns used.

=== Enrollment

Purpose:
- Entity class representing an enrollment.

Annotations:
- `@Entity`, `@GeneratedValue`, `@Getter`, `@Id`, `@Setter`: JPA annotations for entity mapping.

Design Patterns:
- No specific design patterns used.

=== EnrollmentRepository

Purpose:
- Repository interface for Enrollment entities.

Design Patterns:
- No specific design patterns used.

=== EnrollmentService

Purpose:
- Service class for business logic related to enrollments.

Methods:
- `public String nominatePrimaryUser(String username)`: Business logic for nominating a primary user.

Annotations:
- `@Autowired`, `@Service`: Annotations for dependency injection and service definition.

Design Patterns:
- No specific design patterns used.

=== EnrollmentApplicationTests

Purpose:
- Test class for EnrollmentApplication.

Annotations:
- `@SpringBootTest`, `@Test`: Annotations for Spring Boot testing.

Design Patterns:
- No specific design patterns used.

== Runtime View Diagrams

[plantuml, runtime-view]
----
title User Registration Flow
participant UserManagementClient
participant EnrollmentController
UserManagementClient -> EnrollmentController: nominatePrimary
EnrollmentController -> EnrollmentService: nominatePrimaryUser
EnrollmentService -> EnrollmentRepository: Data Access
EnrollmentRepository --> EnrollmentService: Entity
EnrollmentService --> EnrollmentController: Response
EnrollmentController --> UserManagementClient: Response
----

[plantuml, runtime-view]
----
title Authentication/Login Flow
participant EnrollmentController
EnrollmentController -> EnrollmentService: authenticateUser
EnrollmentService -> EnrollmentRepository: Data Access
EnrollmentRepository --> EnrollmentService: User Entity
EnrollmentService --> EnrollmentController: Response
----

[plantuml, runtime-view]
----
title JWT Token Validation Flow
participant EnrollmentController
EnrollmentController -> EnrollmentService: validateToken
EnrollmentService -> EnrollmentRepository: Data Access
EnrollmentRepository --> EnrollmentService: User Entity
EnrollmentService --> EnrollmentController: Response
----

[plantuml, runtime-view]
----
title Key Business Process Flow
participant EnrollmentController
EnrollmentController -> EnrollmentService: processEnrollment
EnrollmentService -> EnrollmentRepository: Data Access
EnrollmentRepository --> EnrollmentService: Enrollment Entity
EnrollmentService --> EnrollmentController: Response
----

[plantuml, runtime-view]
----
title Exception Handling Flow
participant EnrollmentController
EnrollmentController -> EnrollmentService: handleException
EnrollmentService -> EnrollmentRepository: Data Access
EnrollmentRepository --> EnrollmentService: Error Handling
EnrollmentService --> EnrollmentController: Error Response
----

== Entity Relationship Diagram

[plantuml, er-diagram]
----
entity Enrollment {
  + id : Long
  + role : String
  + username : String
  + vin : String
}

entity UserResponseDTO {
  + mobilityUserId : String
  + username : String
  + vin : String
}

Enrollment ||--o UserResponseDTO
----

== Detailed Component Interactions

- Controller-Service-Repository interactions: Controllers interact with services, which in turn interact with repositories for data access.
- Data flow through layers: Data flows from controllers to services and then to repositories for CRUD operations.
- Exception propagation: Exceptions are handled at different layers and propagated back to the caller.
- Transaction boundaries: Transactions are managed at the service layer for ensuring data consistency.

This detailed design document provides insights into the class structure, runtime flows, entity relationships, and component interactions of the Java Spring Boot application. Developers can refer to this document for a comprehensive understanding of the implementation design.