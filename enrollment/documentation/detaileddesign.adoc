= Detailed Design Documentation

== Class-by-Class Analysis

=== EnrollmentApplication

EnrollmentApplication class serves as the entry point for the Spring Boot application. It contains the main method for starting the application.

Annotations:
- @EnableFeignClients: Enables Feign clients for making RESTful API calls.
- @SpringBootApplication: Indicates that this class is the main Spring Boot application class.

Design Patterns: This class follows the standard Spring Boot application structure.

=== UserManagementClient

UserManagementClient class is a Feign client used for communicating with the User Management service.

Annotations:
- @FeignClient: Marks this interface as a Feign client.
- @GetMapping: Defines a GET mapping for the method.
- @RequestParam: Binds the value of a query parameter to a method parameter.

Design Patterns: This class follows the Feign client pattern for RESTful communication.

=== EnrollmentController

EnrollmentController class is a REST controller that handles enrollment-related HTTP requests.

Annotations:
- @Autowired: Injects dependencies.
- @PostMapping: Defines a POST mapping for the method.
- @RequestMapping: Maps HTTP requests to handler methods.
- @RequestParam: Binds the value of a query parameter to a method parameter.
- @RestController: Indicates that this class is a REST controller.

Methods:
- nominatePrimary: Handles the nomination of a primary user.

Fields:
- service: Instance of EnrollmentService used for business logic.

Design Patterns: This class follows the MVC pattern with Spring MVC.

=== UserResponseDTO

UserResponseDTO class represents the response data transfer object for user-related information.

Annotations:
- @Getter: Generates getter methods.
- @Setter: Generates setter methods.

Fields:
- mobilityUserId: User's mobility ID.
- username: User's username.
- vin: Vehicle Identification Number.

Design Patterns: This class follows the Data Transfer Object (DTO) pattern.

=== Enrollment

Enrollment class represents an entity for enrollment information.

Annotations:
- @Entity: Marks this class as a JPA entity.
- @GeneratedValue: Specifies the generation strategy for the primary key.
- @Getter: Generates getter methods.
- @Id: Marks the field as the primary key.
- @Setter: Generates setter methods.

Fields:
- id: Primary key.
- role: User's role.
- username: User's username.
- vin: Vehicle Identification Number.

Design Patterns: This class follows the Entity pattern in JPA.

=== EnrollmentRepository

EnrollmentRepository class is a Spring Data repository interface for managing Enrollment entities.

Design Patterns: This class follows the Repository pattern for data access.

=== EnrollmentService

EnrollmentService class contains business logic related to enrollment operations.

Annotations:
- @Autowired: Injects dependencies.
- @Service: Indicates that this class is a service component.

Methods:
- nominatePrimaryUser: Business logic for nominating a primary user.

Fields:
- repo: Instance of EnrollmentRepository for data access.
- userClient: Instance of UserManagementClient for external service communication.

Design Patterns: This class follows the Service pattern for business logic.

=== EnrollmentApplicationTests

EnrollmentApplicationTests class contains test cases for the EnrollmentApplication class.

Annotations:
- @SpringBootTest: Indicates that this class is a Spring Boot test.
- @Test: Marks a method as a test method.

Design Patterns: This class follows the standard JUnit testing pattern.

== Runtime View Diagrams

[plantuml, runtime-sequence]
----
title User Registration Flow

EnrollmentController -> EnrollmentService: nominatePrimaryUser(username)
EnrollmentService -> UserManagementClient: GET userByUsername(username)
UserManagementClient --> EnrollmentService: UserResponseDTO
EnrollmentService --> EnrollmentController: Success Response
----

[plantuml, runtime-sequence]
----
title Authentication/Login Flow

EnrollmentController -> EnrollmentService: authenticateUser(username, password)
EnrollmentService -> UserManagementClient: POST authenticateUser(username, password)
UserManagementClient --> EnrollmentService: UserResponseDTO
EnrollmentService --> EnrollmentController: JWT Token
----

[plantuml, runtime-sequence]
----
title JWT Token Validation Flow

EnrollmentController -> EnrollmentService: validateToken(token)
EnrollmentService -> UserManagementClient: GET validateToken(token)
UserManagementClient --> EnrollmentService: UserResponseDTO
EnrollmentService --> EnrollmentController: Validation Result
----

[plantuml, runtime-sequence]
----
title Exception Handling Flow

EnrollmentController -> EnrollmentService: processRequest(request)
EnrollmentService -> EnrollmentRepository: fetchData()
EnrollmentRepository --> EnrollmentService: Data
EnrollmentService -> ExceptionHandler: handleException()
ExceptionHandler --> EnrollmentController: Error Response
----

== Entity Relationship Diagram

[plantuml, er-diagram]
----
entity Enrollment {
  + id : Long
  --
  role : String
  username : String
  vin : String
}

entity UserResponseDTO {
  + mobilityUserId : String
  + username : String
  + vin : String
}

Enrollment ||--o UserResponseDTO
----

== Detailed Component Interactions

EnrollmentController -> EnrollmentService: Delegate enrollment operations
EnrollmentService -> EnrollmentRepository: Perform data access
EnrollmentService -> UserManagementClient: Communicate with User Management service
EnrollmentRepository -> Database: CRUD operations
Exception handling propagated through layers
Transaction boundaries managed by Spring framework

This detailed design documentation provides insights into the class structure, runtime flows, entity relationships, and component interactions of the Java Spring Boot application. Developers can refer to this document for a comprehensive understanding of the implementation design.