= Enrollment System Architecture Design

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
skinparam componentStyle uml2

package "Spring Boot Application" {
  [EnrollmentApplication] as EA
  [EnrollmentController] as EC
  [EnrollmentService] as ES
  [EnrollmentRepository] as ER
  [UserManagementClient] as UMC
}

database "Enrollment Database" {
  [DB_Enrollment]
}

[EA] ..> [EC] : uses
[EC] ..> [ES] : uses
[ES] ..> [ER] : uses
[ES] ..> [UMC] : uses
[ER] ..> [DB_Enrollment] : reads/writes

cloud {
  [User Management System] as UMS
}

[UMC] ..> UMS : "Feign Client\nHTTP Requests"

@enduml
----

=== External System Connections and Integrations

The system integrates with an external *User Management System* through a `FeignClient` (UserManagementClient), which handles user-related queries over HTTP.

=== Component Interaction Overview

- **EnrollmentController** receives HTTP requests and delegates business operations to **EnrollmentService**.
- **EnrollmentService** performs the business logic, interacts with **EnrollmentRepository** for database operations, and uses **UserManagementClient** to communicate with the external User Management System.
- **EnrollmentRepository** directly interacts with the database to perform CRUD operations.

=== Technology Stack and Frameworks Used

- **Java Spring Boot**: Framework for creating the application.
- **Spring Data JPA**: For database interactions.
- **Feign**: For REST-based service consumption.
- **H2 Database**: In-memory database for development.
- **PostgreSQL**: Production database.
- **JUnit**: For unit testing.

== 2. Component Description

=== EnrollmentApplication

- **Responsibility**: Bootstraps the Spring Boot application.
- **Role**: Entry point of the application.

=== EnrollmentController

- **Responsibility**: Handle HTTP requests and delegate business logic execution.
- **Role**: REST controller to manage enrollment operations.
- **Interactions**: Communicates directly with **EnrollmentService**.

=== EnrollmentService

- **Responsibility**: Execute business logic for enrollment processes.
- **Role**: Service layer to handle business operations.
- **Interactions**: Uses **EnrollmentRepository** for database operations and **UserManagementClient** for external user data fetching.

=== EnrollmentRepository

- **Responsibility**: Perform database operations.
- **Role**: Data access layer using Spring Data JPA.
- **Interactions**: Interacts with the database to fetch and store enrollment data.

=== UserManagementClient

- **Responsibility**: Communicate with external User Management System.
- **Role**: Feign client to abstract the complexity of HTTP interactions.
- **Interactions**: Sends requests to and receives responses from the User Management System.

== 3. Infrastructure Architecture

=== Deployment Architecture

[plantuml, diagram-deployment, png]
----
@startuml
skinparam componentStyle uml2

node "Web Server" {
  [Spring Boot Application]
}

database "Production Database" {
  [PostgreSQL]
}

[Spring Boot Application] ..> [PostgreSQL] : JDBC
@enduml
----

=== Database Architecture

- **Database**: PostgreSQL for production and H2 for development.
- **Tables**: Enrollment, which stores enrollment details such as user roles and vehicle information.

=== Security Architecture

- **Authentication**: Spring Security for basic authentication.
- **Authorization**: Role-based access control.

=== Network Architecture

- The application is deployed within a secure VPC.
- Only specific ports are exposed for web access, and database access is restricted to the application server.

== 4. System Context

=== External Systems and Their Interfaces

- **User Management System**: Accessed via HTTP REST APIs provided by the Feign client.

=== Data Flow Between Systems

- Data flows from the **EnrollmentController** to **EnrollmentService**, then either to **EnrollmentRepository** or **UserManagementClient** depending on the operation.

=== Authentication and Authorization Flows at System Level

- Authentication is managed via Spring Security, ensuring that only authenticated users can access certain endpoints.
- Authorization ensures that users can only perform actions as per their roles.

This document provides a comprehensive overview of the architecture for the Enrollment System, suitable for understanding by architects and senior developers.