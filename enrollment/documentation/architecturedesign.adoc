= Enrollment System Architecture Design

This document provides a comprehensive architecture design for the Enrollment System, a Java Spring Boot application designed to manage user enrollments for a mobility service. The system allows nominating primary and secondary users for vehicles.

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-arch, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #FFAAAA
!define SERVICE #AAF

package "Spring Boot Application" {
  [EnrollmentApplication] << SPRING >>
  package "Controllers" {
    [EnrollmentController] << SPRING >>
  }
  package "Services" {
    [EnrollmentService] << SERVICE >>
  }
  package "Clients" {
    [UserManagementClient] << SPRING >>
  }
  package "Repositories" {
    [EnrollmentRepository] << SPRING >>
  }
  package "Entities" {
    [Enrollment] << ENTITY >>
  }
  package "DTOs" {
    [UserResponseDTO] << ENTITY >>
  }
}

cloud {
  [User Management System]
}

database "Database" {
  [DB]
}

[EnrollmentApplication] ..> [EnrollmentController]
[EnrollmentController] ..> [EnrollmentService]
[EnrollmentService] ..> [EnrollmentRepository]
[EnrollmentService] ..> [UserManagementClient]
[EnrollmentRepository] ..> [Enrollment]
[UserManagementClient] ..> [User Management System]
[DB] ..> [EnrollmentRepository]

@enduml
----

=== External System Connections and Integrations

The Enrollment System integrates with the following external system:

- *User Management System*: Accessed via `UserManagementClient` using Feign for RESTful communication. It handles user data queries necessary for enrollment processes.

=== Component Interaction Overview

- The `EnrollmentController` receives HTTP requests and delegates operations to `EnrollmentService`.
- `EnrollmentService` performs business logic and interacts with `EnrollmentRepository` for database operations and `UserManagementClient` for external user data.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based applications.
- **Spring Data JPA**: For database operations.
- **Spring Cloud OpenFeign**: For RESTful communication with external services.
- **H2 Database**: In-memory database for development.
- **JUnit**: For unit testing.

== 2. Component Description

=== EnrollmentApplication

- **Role**: Bootstrap the Spring Boot application.
- **Responsibility**: Initialize and configure the Spring context.

=== EnrollmentController

- **Role**: Web controller.
- **Responsibility**: Handle incoming HTTP requests and delegate to services.
- **Interactions**:
  - Invokes `EnrollmentService` for business operations.

=== EnrollmentService

- **Role**: Service layer.
- **Responsibility**: Execute business logic for nominating users.
- **Interactions**:
  - Uses `EnrollmentRepository` for database interactions.
  - Communicates with `UserManagementClient` to fetch user data.

=== UserManagementClient

- **Role**: External service client.
- **Responsibility**: Interface for the User Management System.
- **Interactions**:
  - Communicates with external User Management System.

=== EnrollmentRepository

- **Role**: Data access layer.
- **Responsibility**: Manage database interactions for `Enrollment` entities.

=== Enrollment

- **Role**: Entity model.
- **Responsibility**: Represent the enrollment data model.

=== UserResponseDTO

- **Role**: Data Transfer Object.
- **Responsibility**: Structure for transferring user data.

== 3. Infrastructure Architecture

=== Deployment Architecture

- The application is containerized using Docker, facilitating deployment on Kubernetes for scaling and management.

=== Database Architecture

- Uses H2 in-memory database for development. For production, a transition to a robust SQL database like PostgreSQL is recommended.

=== Security Architecture

- Implements Spring Security for authentication and authorization.
- Uses JWT for secure stateless authentication.

=== Network Architecture

- Deployed within a VPC with restricted access controlled by security groups and network ACLs.

== 4. System Context

=== External Systems and Their Interfaces

- *User Management System*: Provides RESTful endpoints for user data retrieval, integrated via Feign clients.

=== Data Flow Between Systems

- Data flows from the User Management System to the Enrollment System through `UserManagementClient` to fetch necessary user details.

=== Authentication and Authorization Flows at System Level

- Utilizes OAuth2 for securing endpoints. The system verifies tokens against an authorization server to grant access based on roles and permissions.

This architecture design aims to provide a clear, scalable, and secure framework for the Enrollment System, ensuring robust operation and easy maintenance.