= Enrollment System Architecture Design

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
package "Spring Boot Application" {
  [EnrollmentApplication] as EA
  [EnrollmentController] as EC
  [EnrollmentService] as ES
  [EnrollmentRepository] as ER
  [UserManagementClient] as UMC
}

database "Database" {
  [Enrollment]
}

cloud "External Systems" {
  [User Management System]
}

EA --> EC : uses
EC --> ES : uses
ES --> ER : uses
ES --> UMC : uses
ER --> Enrollment : accesses
UMC --> [User Management System] : interacts

@enduml
----

=== External System Connections and Integrations

The system integrates with the following external systems:

- **User Management System**: Accessed via `UserManagementClient` using Feign for RESTful communication. This system manages user data which is essential for enrollment processes.

=== Component Interaction Overview

- **EnrollmentController** handles HTTP requests and communicates with **EnrollmentService**.
- **EnrollmentService** performs business logic and interacts with both **EnrollmentRepository** for database operations and **UserManagementClient** for external user data fetching.
- **EnrollmentRepository** directly manages database transactions related to the `Enrollment` entity.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based Applications.
- **Spring Data JPA**: For database integration and operations.
- **Feign Client**: For declarative REST client creation.
- **H2 Database**: In-memory database for demonstration purposes.
- **JUnit**: For unit testing.

== 2. Component Description

=== EnrollmentApplication

The entry point of the Spring Boot application, responsible for bootstrapping and launching the application.

=== EnrollmentController

A REST controller that exposes HTTP endpoints for enrollment operations such as nominating primary and secondary users.

- **/enrollment/nominate-primary**: Nominates a primary user.
- **/enrollment/nominate-secondary**: Nominates a secondary user.

=== EnrollmentService

Contains business logic for user nomination. It interacts with `EnrollmentRepository` for database operations and `UserManagementClient` to fetch external user data.

=== EnrollmentRepository

Spring Data JPA repository that abstracts CRUD operations for the `Enrollment` entity.

=== UserManagementClient

A Feign client that facilitates communication with external User Management Systems to fetch user details.

=== UserResponseDTO

Data Transfer Object used to encapsulate user data fetched from external systems.

=== Enrollment

JPA entity representing the enrollment data in the database.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for scaling purposes.

=== Database Architecture

Utilizes an H2 in-memory database for development purposes with the scope to switch to a more persistent database like PostgreSQL in production.

=== Security Architecture

Implements Spring Security for authentication and authorization. Utilizes JWT for secure stateless authentication.

=== Network Architecture

The application is deployed within a private subnet with controlled access via an API Gateway, ensuring secure access to endpoints.

== 4. System Context

=== External Systems and Their Interfaces

- **User Management System**: Provides RESTful APIs accessed via Feign clients for user data retrieval.

=== Data Flow Between Systems

Data flows from the User Management System into the Enrollment System where it is processed and stored in the database.

=== Authentication and Authorization Flows at System Level

Utilizes OAuth2 for secure token-based user authentication. The system verifies tokens and grants access to resources based on user roles and permissions.

== Conclusion

This document provides a comprehensive overview of the architecture of the Enrollment System, detailing component interactions, external integrations, and infrastructure setup. This architecture is designed to be scalable, secure, and maintainable, suitable for handling complex user enrollment processes in a microservices environment.