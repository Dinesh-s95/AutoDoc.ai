= Enrollment System Architecture Design

The Enrollment System is a Java Spring Boot application designed to manage user enrollments for a mobility service. This document provides a comprehensive overview of the system architecture, including service architecture, component descriptions, infrastructure, and system context.

== Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-arch, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #FFAA00
!define DATABASE #FFCCCC
!define EXTERNAL #99CCFF

package "Enrollment Application" {
  [EnrollmentApplication] <<SPRING>>
  [EnrollmentController] <<SPRING>>
  [EnrollmentService] <<SPRING>>
  [EnrollmentRepository] <<SPRING>>
  [UserManagementClient] <<SPRING>>
}

database "Enrollment Database" {
  [Enrollment] <<ENTITY>>
}

node "External Systems" {
  [User Management System] <<EXTERNAL>>
}

EnrollmentApplication ..> EnrollmentController
EnrollmentController ..> EnrollmentService
EnrollmentService ..> EnrollmentRepository
EnrollmentRepository ..> Enrollment
EnrollmentService ..> UserManagementClient
UserManagementClient ..> User Management System
@enduml
----

=== External System Connections and Integrations

The system integrates with the following external system:

- *User Management System*: Managed through `UserManagementClient` using Feign for RESTful communication.

=== Component Interaction Overview

The `EnrollmentController` receives HTTP requests and delegates operations to `EnrollmentService`. The service layer handles business logic and interacts with `EnrollmentRepository` for database operations and `UserManagementClient` for external user management tasks.

=== Technology Stack and Frameworks Used

- **Java Spring Boot**: Framework for building the application.
- **Spring Data JPA**: For database interactions.
- **H2 Database**: In-memory database for storing enrollment data.
- **Feign Client**: For RESTful communication with external services.
- **JUnit**: For unit testing.

== Component Description

=== EnrollmentApplication

The entry point of the Spring Boot application, responsible for bootstrapping and configuration.

=== EnrollmentController

A REST controller that handles all incoming HTTP requests related to user enrollment. It uses `EnrollmentService` for processing business logic.

=== EnrollmentService

Contains the business logic for nominating primary and secondary users. It interacts with `EnrollmentRepository` for data persistence and `UserManagementClient` for external communications.

=== EnrollmentRepository

Spring Data JPA repository for accessing the `Enrollment` entity in the database.

=== UserManagementClient

A Feign client for communicating with the external User Management System. It abstracts the complexity of HTTP calls between systems.

=== UserResponseDTO

A Data Transfer Object (DTO) used to encapsulate user data received from external systems.

=== Enrollment

A JPA entity representing the enrollment data model.

== Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for scaling purposes.

=== Database Architecture

The system uses an H2 in-memory database for development purposes. For production, this can be switched to a more robust SQL database like PostgreSQL or MySQL.

=== Security Architecture

Security is managed via Spring Security, providing robust authentication and authorization capabilities. HTTPS is enforced for all communications.

=== Network Architecture

The application is deployed within a private subnet with controlled access via load balancers. Communication with external systems is secured using API keys and HTTPS.

== System Context

=== External Systems and Their Interfaces

The system interacts with a User Management System via REST API, managed by `UserManagementClient`.

=== Data Flow Between Systems

1. HTTP request to nominate a user is received by `EnrollmentController`.
2. `EnrollmentController` calls `EnrollmentService`.
3. `EnrollmentService` performs business logic, interacts with `EnrollmentRepository` for database operations, and communicates with external User Management System via `UserManagementClient`.

=== Authentication and Authorization Flows at System Level

Authentication is handled by Spring Security, which integrates with external identity providers. Authorization is managed via roles and permissions defined within the application and enforced at the controller level.

This architecture document provides a detailed overview of the Enrollment System, designed for architects and senior developers to understand and potentially enhance the system architecture.