= Enrollment System Architecture Design

== Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #FFAA00
!define SERVICE #ADD8E6
!define CONTROLLER #F4A460
!define DATABASE #FFCCCC
!define EXTERNAL #DDDDDD

package "Spring Boot Application" as SBApp {
  node "EnrollmentApplication" as EnrollmentApplication {
    [SpringBootApplication\n@EnableFeignClients] as SpringAnnotations
  }

  package "Web Layer" {
    node "EnrollmentController" as EnrollmentController {
      [RestController\n@Autowired] as ControllerAnnotations
    }
  }

  package "Service Layer" {
    node "EnrollmentService" as EnrollmentService {
      [Service\n@Autowired] as ServiceAnnotations
    }
  }

  package "Data Access Layer" {
    node "EnrollmentRepository" as EnrollmentRepository {
    }
    database "Enrollment" as Enrollment {
      [Entity] as EntityAnnotations
    }
  }

  node "UserManagementClient" as UserManagementClient {
    [FeignClient] as FeignAnnotations
  }
}

cloud "External User Management System" as ExternalSystem {
  [FeignClient] as ExtSystemAnnotations
}

EnrollmentController -down-> EnrollmentService : uses
EnrollmentService -down-> EnrollmentRepository : uses
EnrollmentService -right-> UserManagementClient : uses
UserManagementClient -right-> ExternalSystem : communicates
EnrollmentRepository -down-> Enrollment : accesses

@enduml
----

=== External System Connections and Integrations

The system integrates with an external User Management System via a Feign client (`UserManagementClient`). This integration facilitates operations related to user data which is not stored within the local system.

=== Component Interaction Overview

- **EnrollmentController**: Handles HTTP requests and delegates business logic operations to the `EnrollmentService`.
- **EnrollmentService**: Manages the main business logic, interacts with the `EnrollmentRepository` for data persistence, and communicates with external systems through `UserManagementClient`.
- **EnrollmentRepository**: Abstracts the database access for the `Enrollment` entity.
- **UserManagementClient**: Provides an abstraction over HTTP calls to the external User Management System.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for building stand-alone, production-grade Spring based Applications.
- **Spring Data JPA**: Provides repository support for JPA entities.
- **Spring Security**: For authentication and authorization.
- **Feign**: A declarative web service client for making HTTP requests to external services.
- **H2 Database**: In-memory database for rapid prototyping and testing.
- **JUnit**: For unit testing.

== Component Description

=== EnrollmentApplication

- **Responsibility**: Serves as the bootstrap class containing the main method which launches the Spring Boot application.
- **Role**: Entry point of the Spring Boot application.
- **Interaction**: Initializes the Spring context and all the beans.

=== EnrollmentController

- **Responsibility**: Handles incoming HTTP requests and delegates operations to the `EnrollmentService`.
- **Role**: Web layer component to interact with external clients.
- **Interaction**: Invokes services in the `EnrollmentService` based on API requests.

=== EnrollmentService

- **Responsibility**: Contains business logic for nominating users.
- **Role**: Service layer component that acts as a mediator between the web layer and data access layer.
- **Interaction**: Uses `EnrollmentRepository` for data operations and `UserManagementClient` for external user validations.

=== EnrollmentRepository

- **Responsibility**: Manages database operations for the `Enrollment` entity.
- **Role**: Data Access Object (DAO) that provides an abstraction layer to perform all CRUD operations on the `Enrollment` entity.
- **Interaction**: Interacts directly with the database to retrieve or update `Enrollment` data.

=== UserManagementClient

- **Responsibility**: Facilitates communication with external User Management systems.
- **Role**: External service integration point.
- **Interaction**: Makes HTTP requests to external User Management API.

== Infrastructure Architecture

=== Deployment Architecture

[plantuml, diagram-deployment, png]
----
@startuml
cloud "Cloud Environment" {
  node "Application Server" {
    [EnrollmentApplication]
    database "Database" {
      [Enrollment]
    }
  }
}

node "External Systems" {
  [User Management System]
}

[EnrollmentApplication] --> [Database] : reads/writes
[EnrollmentApplication] --> [User Management System] : HTTP requests

@enduml
----

=== Database Architecture

- **Database**: Uses H2 in-memory database for development. For production, a robust SQL database like PostgreSQL is recommended.
- **Schema**: Consists of the `Enrollment` entity which stores user roles, usernames, and vehicle identification numbers (VINs).

=== Security Architecture

- **Spring Security**: Configured for authentication and authorization. Uses JWT tokens for securing endpoints.
- **HTTPS**: All communications are secured using SSL/TLS.

=== Network Architecture

- **Load Balancer**: Distributes incoming application traffic across multiple instances to increase fault tolerance.
- **Firewall**: Protects against unauthorized access.

== System Context

=== External Systems and Their Interfaces

- **User Management System**: Provides user data necessary for the enrollment process. Accessed via REST API through `UserManagementClient`.

=== Data Flow Between Systems

- Data flows from `EnrollmentController` to `EnrollmentService`, then either to `EnrollmentRepository` for database interactions or to `UserManagementClient` for external API calls.

=== Authentication and Authorization Flows at System Level

- Authentication is handled by Spring Security, which intercepts HTTP requests to authenticate users based on JWT tokens.
- Authorization ensures that only authenticated users can access certain endpoints based on their roles.

This document provides a comprehensive overview of the architecture of the Enrollment System, detailing component responsibilities, interactions, and the technology stack used. It serves as a guide for architects and senior developers involved in the development and maintenance of the system.