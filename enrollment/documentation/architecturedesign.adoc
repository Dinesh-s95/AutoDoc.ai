= Enrollment System Architecture Design

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #MistyRose
!define SERVICE #LightSkyBlue
!define CONTROLLER #LightGoldenRodYellow
!define DATABASE #SandyBrown

package "Spring Boot Application" as SBAPP {
  [EnrollmentApplication] << SPRING >>
  
  package "Controllers" {
    [EnrollmentController] << CONTROLLER >>
  }
  
  package "Services" {
    [EnrollmentService] << SERVICE >>
  }
  
  package "Clients" {
    [UserManagementClient] << SPRING >>
  }
  
  package "Data Model" {
    [Enrollment] << ENTITY >>
  }
  
  package "Data Access" {
    [EnrollmentRepository] << SPRING >>
  }
}

database "External User Management DB" {
  [User Data] << DATABASE >>
}

[EnrollmentApplication] ..> [EnrollmentController]
[EnrollmentController] ..> [EnrollmentService]
[EnrollmentService] ..> [EnrollmentRepository]
[EnrollmentService] ..> [UserManagementClient]
[UserManagementClient] ..> [User Data]
[EnrollmentRepository] ..> [Enrollment]

@enduml
----

=== External System Connections and Integrations

The system integrates with an external User Management System via a `FeignClient` to fetch user data. This integration is crucial for validating user roles and details during the enrollment process.

=== Component Interaction Overview

- **EnrollmentController**: Handles incoming HTTP requests and delegates business logic to the `EnrollmentService`.
- **EnrollmentService**: Core business logic layer that interacts with both the `EnrollmentRepository` for database operations and the `UserManagementClient` for external user data.
- **EnrollmentRepository**: Manages database interactions for the `Enrollment` entity.
- **UserManagementClient**: Facilitates communication with the external User Management System.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based applications.
- **Spring Data JPA**: Provides repository support for JPA data access.
- **Feign**: A declarative web service client for making REST calls.
- **H2 Database**: In-memory database for rapid prototyping and testing.
- **JUnit**: Framework for unit testing Java applications.

== 2. Component Description

=== EnrollmentApplication

- **Role**: Main class that boots up the Spring application.
- **Responsibilities**: Initializes the Spring context and serves as the entry point of the application.

=== EnrollmentController

- **Role**: REST Controller to handle HTTP requests.
- **Responsibilities**: Processes incoming requests related to user enrollment and delegates to `EnrollmentService`.
- **Interactions**: Communicates directly with `EnrollmentService`.

=== EnrollmentService

- **Role**: Service layer to handle business logic.
- **Responsibilities**: Manages the logic for nominating users and interacts with both the repository for data persistence and external services for user validation.
- **Interactions**: Uses `EnrollmentRepository` for database operations and `UserManagementClient` for external API calls.

=== EnrollmentRepository

- **Role**: Repository layer for database operations.
- **Responsibilities**: Provides abstraction over data access layer and interacts with the database to manage `Enrollment` entities.
- **Interactions**: Direct database operations without business logic.

=== UserManagementClient

- **Role**: External service client.
- **Responsibilities**: Communicates with external User Management System to fetch user details.
- **Interactions**: Sends requests to and receives responses from the external User Management System.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing for easy deployment and scaling. It is deployed on Kubernetes for orchestration, ensuring high availability and load balancing.

=== Database Architecture

The application uses an H2 in-memory database for development, with the option to switch to a more scalable option like PostgreSQL for production environments. The database schema is managed through Hibernate with automatic schema generation enabled during development.

=== Security Architecture

Security is enforced through Spring Security, providing both authentication and authorization capabilities. OAuth2 is used for secure API access.

=== Network Architecture

The application is deployed within a VPC (Virtual Private Cloud) with strict firewall rules to ensure that only authorized access is permitted. All traffic is routed through HTTPS to ensure encryption in transit.

== 4. System Context

=== External Systems and Their Interfaces

- **User Management System**: Accessed via REST API, secured by OAuth2. It provides user details necessary for enrollment validation.

=== Data Flow Between Systems

1. `EnrollmentController` receives HTTP request.
2. If user validation is needed, `EnrollmentService` calls `UserManagementClient`.
3. `UserManagementClient` fetches user data from the external User Management System.
4. User data is returned to `EnrollmentService` for processing.
5. Results are persisted through `EnrollmentRepository` if necessary.

=== Authentication and Authorization Flows at System Level

Authentication is managed via Spring Security with OAuth2 tokens. Users are authenticated against the User Management System, and tokens are used to authorize requests to the Enrollment System.

This document provides a comprehensive overview of the architecture of the Enrollment System, designed for understanding by architects and senior developers.