= Enrollment System Architecture Design Document

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #FFD700
!define SERVICE #ADD8E6
!define CONTROLLER #F4A460

package "Enrollment Application" {
  [EnrollmentApplication] << (S, SPRING) >>
}

package "Web Layer" {
  [EnrollmentController] << (C, CONTROLLER) >>
}

package "Service Layer" {
  [EnrollmentService] << (S, SERVICE) >>
}

package "Data Access Layer" {
  [EnrollmentRepository] << (R, SPRING) >>
}

package "Integration Layer" {
  [UserManagementClient] << (C, SPRING) >>
}

package "External Systems" {
  [User Management System] << (E, SPRING) >>
}

package "Data Model" {
  [Enrollment] << (E, ENTITY) >>
  [UserResponseDTO] << (D, ENTITY) >>
}

[EnrollmentApplication] --> [EnrollmentController]
[EnrollmentController] --> [EnrollmentService]
[EnrollmentService] --> [EnrollmentRepository]
[EnrollmentService] --> [UserManagementClient]
[UserManagementClient] --> [User Management System]
[EnrollmentRepository] ..> [Enrollment]

@enduml
----

=== External System Connections and Integrations

The system integrates with an external User Management System via the `UserManagementClient` using Feign for RESTful communication. This client is responsible for fetching user data necessary for enrollment processes.

=== Component Interaction Overview

- **EnrollmentController**: Handles HTTP requests and delegates business operations to the `EnrollmentService`.
- **EnrollmentService**: Manages the main business logic, interacts with the `EnrollmentRepository` for database operations, and uses `UserManagementClient` to communicate with external systems.
- **EnrollmentRepository**: Provides data access functionalities for the `Enrollment` entity.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based applications.
- **Spring Data JPA**: Provides repository support for JPA data access.
- **Feign**: A declarative web service client for making REST calls.
- **H2 Database**: In-memory database for rapid prototyping and development.
- **JUnit**: For unit testing of the application components.

== 2. Component Description

=== EnrollmentApplication

- **Responsibility**: Bootstraps the Spring Boot application.
- **Role**: Entry point of the Spring Boot application.

=== UserManagementClient

- **Responsibility**: Communicates with external User Management System.
- **Role**: Feign client for external API calls to manage user data.

=== EnrollmentController

- **Responsibility**: Handles web requests and orchestrates user enrollment processes.
- **Role**: REST controller to manage enrollment related HTTP requests.

=== UserResponseDTO

- **Responsibility**: Data transfer object to carry user data.
- **Role**: DTO used for communication between services and external APIs.

=== Enrollment

- **Responsibility**: Represents the enrollment entity in the system.
- **Role**: JPA entity mapped to the database table for enrollments.

=== EnrollmentRepository

- **Responsibility**: Handles CRUD operations for the `Enrollment` entity.
- **Role**: Spring Data JPA repository.

=== EnrollmentService

- **Responsibility**: Contains business logic for managing enrollments.
- **Role**: Service layer component that uses `EnrollmentRepository` and `UserManagementClient`.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for better scalability and management.

=== Database Architecture

The application uses an H2 in-memory database for development, with entities managed by Hibernate ORM. For production, a migration to a more persistent database system like PostgreSQL is recommended.

=== Security Architecture

Security is managed via Spring Security, providing robust authentication and authorization capabilities. Integration with OAuth2 for external service authentication is advised for production environments.

=== Network Architecture

The application is designed to be deployed within a secure VPC, with access controlled via security groups and network ACLs. Communication with external APIs is secured using HTTPS.

== 4. System Context

=== External Systems and Their Interfaces

- **User Management System**: Accessed via REST API through `UserManagementClient`. Provides user data necessary for enrollment processes.

=== Data Flow Between Systems

Data flows from the `EnrollmentController` to `EnrollmentService`, then either to `EnrollmentRepository` for database interactions or `UserManagementClient` for external API interactions, depending on the operation.

=== Authentication and Authorization Flows at System Level

Authentication is handled via Spring Security, supporting multiple authentication mechanisms. Authorization is managed using role-based access control (RBAC) within the application.