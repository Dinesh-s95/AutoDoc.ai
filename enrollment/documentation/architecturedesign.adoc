== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
package "Enrollment System" {
  node "EnrollmentApplication" {
    [EnrollmentController] 
    [EnrollmentService]
    [EnrollmentRepository]
    database "Enrollment Database" {
      [Enrollment]
    }
  }

  node "External Systems" {
    [UserManagementClient] --> [User API]
  }

  [EnrollmentController] --> [EnrollmentService]
  [EnrollmentService] --> [EnrollmentRepository]
  [EnrollmentService] --> [UserManagementClient]
  [UserManagementClient] ..> [User API] : FeignClient
@enduml
----

=== External System Connections and Integrations

The Enrollment System integrates with an external User Management API using a Feign client (`UserManagementClient`). This client handles communication and data exchange between the Enrollment System and the User Management API, facilitating operations such as user data retrieval.

=== Component Interaction Overview

The `EnrollmentController` receives HTTP requests and interacts with the `EnrollmentService` to process business logic. The `EnrollmentService` uses `EnrollmentRepository` for data persistence and interacts with the `UserManagementClient` to fetch or verify user data from external systems.

=== Technology Stack and Frameworks Used

- **Programming Language:** Java
- **Framework:** Spring Boot
- **Data Access:** Spring Data JPA
- **Remote Service Communication:** Spring Cloud OpenFeign
- **Database:** MySQL
- **Testing:** Spring Boot Test

== 2. Component Description

=== EnrollmentApplication

The entry point of the application, annotated with `@SpringBootApplication` and `@EnableFeignClients`. It initializes the Spring Boot application and enables Feign clients for external API communication.

=== UserManagementClient

A Feign client that provides an abstraction over HTTP requests to the external User Management API. It is responsible for fetching user data required by the Enrollment System.

=== EnrollmentController

A REST controller (`@RestController`) that handles incoming HTTP requests. It uses `EnrollmentService` to perform business operations. It is responsible for managing HTTP endpoints related to user enrollments.

=== UserResponseDTO

A Data Transfer Object (DTO) used to encapsulate user data received from external systems or sent from the controllers.

=== Enrollment

An entity (`@Entity`) representing the enrollment data model. It includes fields such as `id`, `role`, `username`, and `vin`. It is managed by JPA for data persistence.

=== EnrollmentRepository

A Spring Data repository that provides CRUD operations on the `Enrollment` entity. It abstracts the database access layer.

=== EnrollmentService

A service (`@Service`) that contains business logic for nominating primary users. It interacts with both `EnrollmentRepository` and `UserManagementClient`.

== 3. Infrastructure Architecture

=== Deployment Architecture

The system is containerized using Docker, allowing it to be deployed on any platform supporting Docker. Kubernetes is used for orchestration, providing scalability and resilience.

=== Database Architecture

The system uses MySQL as the relational database. `Enrollment` data is stored in a structured format, with tables representing the entities.

=== Security Architecture

Security is managed using Spring Security, which provides authentication and authorization. HTTPS is enforced for all communications.

=== Network Architecture

The system is deployed within a VPC (Virtual Private Cloud), with controlled access to the internet and external systems. Internal communication happens within the private subnet.

== 4. System Context

=== External Systems and Their Interfaces

The system interacts with a User Management API, which provides user-related operations. The interface is accessed via HTTP/HTTPS using the Feign client.

=== Data Flow Between Systems

Data flows from the `EnrollmentController` to `EnrollmentService`, then either to `EnrollmentRepository` for database operations or to `UserManagementClient` for external API interactions.

=== Authentication and Authorization Flows at System Level

Authentication is handled via OAuth2 tokens. The system validates these tokens for each request, ensuring that only authenticated users can access the API endpoints. Authorization is managed based on user roles defined within the system.

This architecture document provides a detailed overview of the Enrollment System, designed for scalability, security, and efficient data management, suitable for understanding by architects and senior developers.