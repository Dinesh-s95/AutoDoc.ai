= Enrollment System Architecture Design

== Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #MistyRose
!define DATABASE #LightGoldenRodYellow
!define EXTERNAL #Violet

package "Spring Boot Application" as SpringApp {
  component [EnrollmentApplication] <<SPRING>>
  component [EnrollmentController] <<SPRING>> {
    [nominatePrimary]
    [nominatePrimarygreet]
  }
  component [EnrollmentService] <<SPRING>> {
    [nominatePrimaryUser]
  }
  database [EnrollmentRepository] <<DATABASE>> {
    [Enrollment Entity]
  }
}

node "External Systems" {
  [User Management System] <<EXTERNAL>>
}

SpringApp ..> User Management System : Uses >\nFeignClient
EnrollmentController --> EnrollmentService : Calls
EnrollmentService --> EnrollmentRepository : Uses
EnrollmentRepository ..> [Enrollment Entity] : Persists
@enduml
----

=== External System Connections and Integrations

The system integrates with an external **User Management System** via a Feign client (`UserManagementClient`). This client is responsible for fetching user details necessary for the enrollment process.

=== Component Interaction Overview

1. **EnrollmentController** receives HTTP requests and delegates business logic execution to **EnrollmentService**.
2. **EnrollmentService** interacts with **EnrollmentRepository** to perform data persistence operations.
3. **EnrollmentService** also communicates with the external **User Management System** to retrieve user data.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring-based applications.
- **Spring Data JPA**: For database operations.
- **Feign**: For declarative REST client creation.
- **H2 Database**: In-memory database for development purposes.
- **JUnit**: For unit testing.

== Component Description

=== EnrollmentApplication

- **Responsibility**: Serves as the bootstrap class containing the main method that starts the Spring Boot application.
- **Role**: Entry point of the Spring Boot application.

=== EnrollmentController

- **Responsibility**: Handles incoming HTTP requests and interacts with services to perform business operations.
- **Role**: REST controller that manages enrollment-related requests.
- **Interactions**: Calls `EnrollmentService` for business operations.

=== EnrollmentService

- **Responsibility**: Contains business logic to process enrollment operations.
- **Role**: Service layer that abstracts business logic from the web layer.
- **Interactions**:
  - Uses `EnrollmentRepository` for data persistence.
  - Communicates with `UserManagementClient` to fetch external user data.

=== EnrollmentRepository

- **Responsibility**: Interface for database operations, extending Spring Data JPA repositories.
- **Role**: Data Access Object (DAO) for `Enrollment` entities.
- **Interactions**: Interacts directly with the database to manage `Enrollment` entities.

=== UserManagementClient

- **Responsibility**: Feign client for interacting with the external User Management System.
- **Role**: External service invoker.
- **Interactions**: Used by `EnrollmentService` to fetch user data.

== Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, facilitating easy deployment and scalability. It is designed to be deployed on Kubernetes for better resource management and orchestration.

=== Database Architecture

The system uses an H2 in-memory database for development, with entities managed by Spring Data JPA. For production, a transition to a more robust SQL database like PostgreSQL is recommended.

=== Security Architecture

Security is enforced via Spring Security, providing both authentication and authorization capabilities. JWT tokens are used for stateless authentication.

=== Network Architecture

The application is designed to be deployed within a private subnet with controlled access. Only the necessary ports are exposed, and communication between services is secured using TLS.

== System Context

=== External Systems and Their Interfaces

- **User Management System**: Accessed via REST APIs provided by the `UserManagementClient` using Feign.

=== Data Flow Between Systems

1. `EnrollmentController` receives user data and passes it to `EnrollmentService`.
2. `EnrollmentService` may call `UserManagementClient` to fetch additional user details.
3. Data is persisted through `EnrollmentRepository` into the database.

=== Authentication and Authorization Flows at System Level

Authentication is managed by Spring Security, using JWT for verifying user credentials and generating tokens. Authorization is role-based, ensuring users can only access permitted resources.