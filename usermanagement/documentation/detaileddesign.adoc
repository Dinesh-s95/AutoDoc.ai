= User Management System Detailed Design Documentation

This document provides a comprehensive detailed design of the User Management System developed using Java with Spring Boot. It includes class-by-class analysis, runtime view diagrams, entity relationship diagrams, and detailed component interactions.

== 1. Class-by-Class Analysis

=== 1.1 UsermanagementApplication

*Purpose*: Serves as the entry point for the Spring Boot application.

*Annotations*:
- `@EnableFeignClients`: Enables the discovery and management of Feign clients.
- `@SpringBootApplication`: Denotes the main configuration class that powers up the Spring context.

*Methods*:
- `public static void main(String[] args)`: Launches the Spring Boot application.

=== 1.2 IdentityProviderClient

*Purpose*: Defines a client to communicate with an external identity provider service using Feign.

*Annotations*:
- `@FeignClient`: Declares this interface as a Feign client.
- `@PostMapping`: Indicates that the annotated method handles HTTP POST requests.
- `@RequestBody`: Indicates a method parameter should be bound to the body of the web request.

=== 1.3 VehicleManagementClient

*Purpose*: Defines a client to interact with an external vehicle management service using Feign.

*Annotations*:
- `@FeignClient`: Marks this interface as a Feign client.
- `@GetMapping`: Indicates that the annotated method handles HTTP GET requests.
- `@RequestParam`: Indicates a method parameter should be bound to a web request parameter.

=== 1.4 UserManagementController

*Purpose*: Handles incoming web requests related to user management.

*Annotations*:
- `@RestController`: Marks the class as a controller where every method returns a domain object instead of a view.
- `@RequestMapping`: Maps web requests onto methods in request-handling classes.
- `@Autowired`: Marks a constructor, field, or setter method to be autowired by Spring's dependency injection facilities.

*Methods*:
- `public String onboardUser(String username, String password)`: Handles the user onboarding process.
- `public String assignVehicle(String username, String vin, String brand, String country)`: Assigns a vehicle to a user.

=== 1.5 MobilityUser

*Purpose*: Represents the user entity in the database.

*Annotations*:
- `@Entity`: Specifies that the class is an entity and is mapped to a database table.
- `@Table`: Specifies the table in the database with which the entity is mapped.
- `@Id`: Specifies the primary key of an entity.
- `@GeneratedValue`: Provides the specification of generation strategies for the values of primary keys.
- `@Getter` / `@Setter`: Lombok annotations to generate getters and setters automatically.

*Fields*:
- `id: Long`: The primary key.
- `mobilityUserId: String`: A unique identifier for the user.
- `role: String`: The user's role.
- `username: String`: The username.
- `vin: String`: The vehicle identification number assigned to the user.

=== 1.6 UserManagementRepository

*Purpose*: Provides an abstraction layer to perform CRUD operations on the `MobilityUser` entity.

=== 1.7 UserManagementService

*Purpose*: Contains business logic for managing users and vehicles.

*Annotations*:
- `@Service`: Indicates that the class holds business logic.

*Methods*:
- `public Optional<MobilityUser> getUserByUsername(String username)`: Retrieves a user by username.
- `public String onboardUser(String username, String password)`: Facilitates user onboarding.
- `public void assignVehicleToUser(String username, String vin, String brand, String country)`: Assigns a vehicle to a user.

*Fields*:
- `identityProvider: IdentityProviderClient`: A Feign client for identity provider interactions.
- `repo: UserManagementRepository`: Repository for database operations.
- `vehicleClient: VehicleManagementClient`: A Feign client for vehicle management interactions.

=== 1.8 UsermanagementApplicationTests

*Purpose*: Contains integration tests for the application.

*Annotations*:
- `@SpringBootTest`: Provides integration test support.
- `@Test`: Denotes that a method is a test method.

== 2. Runtime View Diagrams

Due to the complexity and length, the sequence diagrams will be provided in a separate section following this one.

== 3. Entity Relationship Diagram

[plantuml, erd-diagram, png]
----
entity MobilityUser {
  * id : Long
  --
  * mobilityUserId : String
  * role : String
  * username : String
  * vin : String
}
----

== 4. Detailed Component Interactions

=== Controller-Service-Repository Interactions

- **UserManagementController**:
  - Calls **UserManagementService** methods to handle HTTP requests.
- **UserManagementService**:
  - Uses **UserManagementRepository** to interact with the database.
  - Communicates with external services through **IdentityProviderClient** and **VehicleManagementClient**.

=== Data Flow Through Layers

1. **Controller** receives HTTP request.
2. **Service** processes business logic.
3. **Repository** performs database operations.
4. Data is returned back through the layers to the user.

=== Exception Propagation

- Exceptions are thrown from the repository or external clients and are handled in the service layer, potentially resulting in custom exceptions being thrown back to the controller.

=== Transaction Boundaries

- Transactions are managed at the service layer, ensuring that database operations are completed successfully before returning a response.

== 5. Sequence Diagrams

Due to the complexity and length, the sequence diagrams will be provided in a separate section following this one.