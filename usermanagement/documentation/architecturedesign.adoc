= Architecture Design Document

== Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, system_architecture]
----
@startuml
package "User Management System" {
  [UserManagementController]
  [UserManagementService]
  [UserManagementRepository]
  [IdentityProviderClient]
  [VehicleManagementClient]
  [MobilityUser]

  [UserManagementController] --> [UserManagementService]
  [UserManagementService] --> [UserManagementRepository]
  [UserManagementService] --> [IdentityProviderClient]
  [UserManagementService] --> [VehicleManagementClient]
  [MobilityUser] --> [UserManagementRepository]
}
@enduml
----

=== External System Connections and Integrations

The User Management System interacts with the following external systems:
- Identity Provider System (via IdentityProviderClient)
- Vehicle Management System (via VehicleManagementClient)

=== Component Interaction Overview

The User Management System consists of the following components:
- UserManagementController: Handles HTTP requests and delegates actions to UserManagementService.
- UserManagementService: Contains business logic and interacts with repositories and external systems.
- UserManagementRepository: Manages the persistence of MobilityUser entities.
- IdentityProviderClient: Integrates with the Identity Provider System for authentication.
- VehicleManagementClient: Integrates with the Vehicle Management System for vehicle-related operations.
- MobilityUser: Represents a user entity in the system.

=== Technology Stack and Frameworks Used

The User Management System is built using:
- Java Spring Boot
- Feign for REST client
- JPA for data persistence

== Component Description

=== UserManagementController

The UserManagementController is responsible for handling HTTP requests related to user management operations. It delegates the actual business logic to the UserManagementService component.

=== UserManagementService

The UserManagementService component contains the core business logic of the system. It interacts with the UserManagementRepository for data persistence, IdentityProviderClient for authentication, and VehicleManagementClient for vehicle-related operations.

=== UserManagementRepository

The UserManagementRepository component manages the persistence of MobilityUser entities in the database.

=== IdentityProviderClient

The IdentityProviderClient component integrates with the external Identity Provider System for user authentication.

=== VehicleManagementClient

The VehicleManagementClient component integrates with the external Vehicle Management System for vehicle-related operations.

=== MobilityUser

The MobilityUser component represents a user entity in the system with attributes like id, mobilityUserId, role, username, and vin.

=== How Components Interact

- UserManagementController interacts with UserManagementService for business logic.
- UserManagementService interacts with UserManagementRepository for data persistence, IdentityProviderClient for authentication, and VehicleManagementClient for vehicle operations.
- MobilityUser interacts with UserManagementRepository for database operations.

=== External Dependencies and Integrations

The User Management System depends on external systems like the Identity Provider System and Vehicle Management System for authentication and vehicle-related operations, respectively.

== Infrastructure Architecture

=== Deployment Architecture

The User Management System is deployed as a Spring Boot application on a cloud-based infrastructure.

=== Database Architecture

The system uses a relational database to store user and related data. JPA is used for object-relational mapping.

=== Security Architecture

The system ensures security by integrating with the Identity Provider System for user authentication and authorization.

=== Network Architecture

The system communicates with external systems over secure HTTP connections.

== System Context

=== External Systems and Interfaces

- Identity Provider System: Provides authentication services via the IdentityProviderClient.
- Vehicle Management System: Manages vehicle-related operations via the VehicleManagementClient.

=== Data Flow Between Systems

- User Management System sends requests to the Identity Provider System for user authentication.
- User Management System interacts with the Vehicle Management System for vehicle-related operations.

=== Authentication and Authorization Flows

The system follows a secure authentication flow by delegating user authentication to the Identity Provider System.

== Conclusion

The User Management System is a Java Spring Boot application that manages user-related operations by integrating with external systems for authentication and vehicle management. The system architecture ensures modularity, scalability, and security through component-based design and external system integrations.