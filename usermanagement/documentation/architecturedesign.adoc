[plantuml, "system_architecture_diagram", png]
----
@startuml
skinparam componentStyle uml2

package "User Management System" {
  [UserManagementApplication] as UMA
  [UserManagementController] as UMC
  [UserManagementService] as UMS
  [UserManagementRepository] as UMR
  [MobilityUser] as MU

  UMA --> UMC : initiates
  UMC --> UMS : uses
  UMS --> UMR : accesses
  UMS --> MU : manages
}

package "External Systems" {
  [IdentityProviderClient] as IPC
  [VehicleManagementClient] as VMC
}

UMS --> IPC : "FeignClient\nAuthentication"
UMS --> VMC : "FeignClient\nVehicle Data"

@enduml
----

=== External System Connections and Integrations

The User Management System integrates with the following external systems:
- **Identity Provider System**: Managed through `IdentityProviderClient`, this integration handles user authentication and authorization.
- **Vehicle Management System**: Managed through `VehicleManagementClient`, this integration provides vehicle-related data and operations.

=== Component Interaction Overview

- **UserManagementController** receives HTTP requests and delegates operations to **UserManagementService**.
- **UserManagementService** performs business logic, interacts with the database through **UserManagementRepository**, and communicates with external systems.
- **MobilityUser** represents the user entity and is managed by **UserManagementService**.

=== Technology Stack and Frameworks Used

- **Java Spring Boot**: Framework for creating stand-alone, production-grade Spring based applications.
- **Feign**: A declarative web service client for making HTTP requests to external systems.
- **Spring Data JPA**: For database operations.
- **H2 Database**: In-memory database for demonstration purposes.
- **JUnit**: For unit testing.

== 2. Component Description

=== UserManagementApplication

- **Responsibility**: Serves as the entry point for the Spring Boot application.
- **Role**: Initializes the Spring context and bootstraps the application.

=== IdentityProviderClient

- **Responsibility**: Interface for communication with the Identity Provider System.
- **Role**: Handles authentication and authorization tasks.
- **External Dependencies**: Identity Provider API.

=== VehicleManagementClient

- **Responsibility**: Interface for communication with the Vehicle Management System.
- **Role**: Fetches vehicle data and performs vehicle-related operations.
- **External Dependencies**: Vehicle Management API.

=== UserManagementController

- **Responsibility**: Handles incoming HTTP requests.
- **Role**: Delegates business operations to the UserManagementService.
- **Interactions**: Receives data from clients and interacts with UserManagementService.

=== MobilityUser

- **Responsibility**: Represents the user entity in the system.
- **Role**: Stores user data such as username, role, and associated vehicle information.

=== UserManagementRepository

- **Responsibility**: Interface for database operations related to users.
- **Role**: Abstraction over the data access layer.

=== UserManagementService

- **Responsibility**: Contains business logic for managing users.
- **Role**: Manages user data and interactions with external systems.
- **Interactions**: Uses UserManagementRepository for database operations and communicates with external clients.

== 3. Infrastructure Architecture

=== Deployment Architecture

- The application is containerized using Docker, allowing for easy deployment and scaling.
- Deployed on Kubernetes for orchestration.

=== Database Architecture

- Uses H2 in-memory database for demonstration purposes.
- Configured to use Spring Data JPA for ORM.

=== Security Architecture

- Integrates with an external Identity Provider for authentication.
- Uses Spring Security for securing endpoints.

=== Network Architecture

- Deployed within a VPC for isolation.
- Uses API Gateway for managing incoming requests and routing them to appropriate services.

== 4. System Context

=== External Systems and Their Interfaces

- **Identity Provider System**: Provides RESTful APIs for authentication and user management.
- **Vehicle Management System**: Offers RESTful APIs for vehicle information and management.

=== Data Flow Between Systems

- User data flows from **UserManagementController** to **UserManagementService**, then to either **UserManagementRepository** or external systems like Identity Provider and Vehicle Management.

=== Authentication and Authorization Flows at System Level

- Authentication is handled via the Identity Provider.
- Authorization checks are performed at the controller level using Spring Security based on user roles and permissions.

This architecture document provides a comprehensive overview of the User Management System, focusing on system design, component interactions, and integration with external systems.