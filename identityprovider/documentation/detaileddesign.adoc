= Detailed Design Documentation: Identity Provider Application

This document provides a comprehensive detailed design of the Identity Provider Application developed using Java Spring Boot. It includes class-by-class analysis, runtime view diagrams, entity relationship diagrams, and detailed component interactions.

== 1. Class-by-Class Analysis

=== IdentityproviderApplication

*Purpose:* Serves as the entry point for the Spring Boot application.

*Annotations:*
- `@SpringBootApplication`: Indicates that this is a Spring Boot application.

*Methods:*
- `public static void main(String[] args)`: Launches the Spring Boot application.

=== JwtAuthFilter

*Purpose:* Filter to manage JWT authentication within the application.

*Annotations:*
- `@Autowired`: Automatically injects the required beans.
- `@Component`: Marks the class as a Spring component.
- `@Override`: Indicates that a method declaration is intended to override a method declaration in a supertype.
- `@Slf4j`: Provides a logger.

*Methods:*
- `protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException`: Filters incoming requests and manages JWT authentication.

*Fields:*
- `userService : UserService`: Service used for user-related operations.

=== SecurityConfig

*Purpose:* Configuration for security aspects of the application.

*Annotations:*
- `@Autowired`: Automatically injects the required beans.
- `@Bean`: Indicates that a method produces a bean to be managed by the Spring container.
- `@Configuration`: Indicates that the class has @Bean definition methods.
- `@EnableWebSecurity`: Enables Spring Security's web security support.

*Methods:*
- `public AuthenticationManager authenticationManager(final AuthenticationConfiguration authConfig) throws Exception`: Configures the authentication manager.
- `public AuthenticationProvider authenticationProvider()`: Provides a custom authentication provider.
- `public SecurityFilterChain securityFilterChain(final HttpSecurity http) throws Exception`: Defines security filter chain.

*Fields:*
- `jwtAuthFilter : JwtAuthFilter`: JWT authentication filter.
- `userDetailsService : UserDetailsService`: Service to load user-specific data.

=== UserController

*Purpose:* Controller to handle user-related operations such as registration and login.

*Annotations:*
- `@Autowired`: Automatically injects the required beans.
- `@GetMapping`, `@PostMapping`: Annotation for mapping HTTP GET/POST requests onto specific handler methods.
- `@RequestBody`: Annotation indicating a method parameter should be bound to the body of the HTTP request.
- `@RequestMapping`: Annotation for mapping web requests onto methods in request-handling classes.
- `@RestController`: Marks the class as a controller where every method returns a domain object instead of a view.

*Methods:*
- `public ResponseEntity<Object> login(@RequestBody final Users user)`: Handles user login.
- `public String greet()`, `public String greet2()`: Simple greeting methods.
- `public Users registerUser(@RequestBody final Users user)`: Handles user registration.

*Fields:*
- `authManager : AuthenticationManager`: Manages authentication.
- `jwtService : JWTService`: Service for JWT operations.
- `userService : UserService`: Service used for user-related operations.

=== Users

*Purpose:* Entity representing a user.

*Annotations:*
- `@Data`: Lombok annotation to create all the getters, setters, equals, hash, and toString methods, based on the fields.
- `@Entity`: Specifies that the class is an entity.
- `@GeneratedValue`: Specifies the generation strategies for the values of primary keys.
- `@Getter`, `@Setter`: Lombok annotations to generate getters and setters.
- `@Id`: Specifies the primary key of an entity.

*Methods:*
- `public String getPassword()`: Returns user's password.
- `public String getUsername()`: Returns user's username.

*Fields:*
- `password : String`: User's password.
- `userId : Long`: User's ID.
- `username : String`: User's username.

=== UserRepository

*Purpose:* Repository for accessing user data.

*Annotations:*
- `@Repository`: Indicates that the class is a repository.

=== JWTService

*Purpose:* Service to manage JWT token operations.

*Annotations:*
- `@Service`: Indicates that the class is a service.
- `@Slf4j`: Provides a logger.

*Methods:*
- `public String extractUsername(String token)`: Extracts username from the token.
- `public String generateToken(final String username)`: Generates a token for a given username.
- `public boolean validateToken(String token)`: Validates the given token.

*Fields:*
- `secretKey : final Key`: Secret key used for token generation.

=== UserService

*Purpose:* Service for user-related operations.

*Annotations:*
- `@Autowired`: Automatically injects the required beans.
- `@Override`: Indicates that a method declaration is intended to override a method declaration in a supertype.
- `@Service`: Indicates that the class is a service.

*Methods:*
- `public UserDetails loadUserByUsername(final String username) throws UsernameNotFoundException`: Loads user details by username.
- `public Users register(final Users user)`: Registers a new user.

*Fields:*
- `encoder : BCryptPasswordEncoder`: Password encoder.
- `userRepository : UserRepository`: Repository used for accessing user data.

=== IdentityproviderApplicationTests

*Purpose:* Tests for the Identity Provider Application.

*Annotations:*
- `@SpringBootTest`: Indicates that the class should bootstrap with Spring Boot's support.
- `@Test`: Indicates that the method is a test method.

== 2. Runtime View Diagrams

=== User Registration Flow

[plantuml, user-registration-sequence, png]
----
@startuml
actor User
boundary UserController
entity UserService
database UserRepository

User -> UserController : registerUser(user)
UserController -> UserService : register(user)
UserService -> UserRepository : save(user)
UserRepository --> UserService : user
UserService --> UserController : user
UserController --> User : user
@enduml
----

=== Authentication/Login Flow

[plantuml, authentication-sequence, png]
----
@startuml
actor User
boundary UserController
entity UserService
entity JWTService

User -> UserController : login(authRequest)
UserController -> UserService : loadUserByUsername(username)
UserService --> UserController : userDetails
UserController -> JWTService : generateToken(username)
JWTService --> UserController : token
UserController --> User : token
@enduml
----

=== JWT Token Validation Flow

[plantuml, jwt-validation-sequence, png]
----
@startuml
actor User
boundary JwtAuthFilter
entity JWTService

User -> JwtAuthFilter : request(resource)
JwtAuthFilter -> JWTService : validateToken(token)
JWTService --> JwtAuthFilter : isValid
JwtAuthFilter --> User : proceed / error
@enduml
----

== 3. Entity Relationship Diagram

[plantuml, entity-relationship-diagram, png]
----
@startuml
entity Users {
  * userId : Long
  --
  * username : String
  * password : String
}

@enduml
----

== 4. Detailed Component Interactions

=== Controller-Service-Repository Interactions

*UserController -> UserService -> UserRepository:* UserController receives HTTP requests for user operations and delegates them to UserService, which in turn interacts with UserRepository to retrieve or persist data.

=== Data Flow Through Layers

*Data Flow:* Data flows from the controller to the service layer where business logic is applied, and then to the repository layer for database interactions. The flow is typically bidirectional, with data being sent back to the user.

=== Exception Propagation

*Exception Handling:* Exceptions are thrown at the repository or service layers and are propagated up to the controllers where they are handled and appropriate HTTP responses are generated.

=== Transaction Boundaries

*Transactions:* Transactions are managed at the service layer, ensuring that database operations are completed successfully before committing the transaction.

This detailed design document provides a comprehensive overview of the Identity Provider Application, facilitating understanding and further development.