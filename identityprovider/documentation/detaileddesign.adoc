= Identity Provider Application Detailed Design Documentation

This document provides a comprehensive detailed design of the Identity Provider Application implemented using Java Spring Boot. It includes class-by-class analysis, runtime view diagrams, entity relationship diagrams, and detailed component interactions.

== 1. Class-by-Class Analysis

=== 1.1 IdentityproviderApplication

*Purpose:* Serves as the entry point for the Spring Boot application.

*Annotations:*
- `@SpringBootApplication`: Indicates a configuration class that declares one or more `@Bean` methods and also triggers auto-configuration and component scanning.

*Methods:*
- `public static void main(String[] args)`: The main method that uses Spring Boot’s `SpringApplication.run()` method to launch the application.

=== 1.2 JwtAuthFilter

*Purpose:* Filter that intercepts requests to validate JWT tokens.

*Annotations:*
- `@Autowired`: Marks a dependency to be injected by Spring’s dependency injection facilities.
- `@Component`: Indicates that the class is a Spring-managed component.
- `@Slf4j`: Lombok annotation to provide a logger.

*Methods:*
- `protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException`: Intercepts requests to check for the presence of a JWT token, validates it, and sets the authentication in the security context.

*Fields:*
- `userService : UserService`: Dependency to interact with user data.

=== 1.3 SecurityConfig

*Purpose:* Configuration for security aspects of the application.

*Annotations:*
- `@Configuration`: Indicates that the class is a source of bean definitions.
- `@EnableWebSecurity`: Enables Spring Security’s web security support.

*Methods:*
- `public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception`: Defines the application’s authentication manager.
- `public AuthenticationProvider authenticationProvider()`: Provides a custom authentication provider.
- `public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception`: Configures the security filter chain.

*Fields:*
- `jwtAuthFilter : JwtAuthFilter`: JWT authentication filter.
- `userDetailsService : UserDetailsService`: Service to load user-specific data.

=== 1.4 UserController

*Purpose:* Controller to handle user-related operations such as registration and login.

*Annotations:*
- `@RestController`: Marks the class as a controller where every method returns a domain object instead of a view.
- `@RequestMapping`: Maps HTTP requests to handler methods of MVC and REST controllers.
- `@Autowired`: Marks a dependency to be injected.

*Methods:*
- `public ResponseEntity<Object> login(@RequestBody final Users user)`: Handles user login requests.
- `public Users registerUser(@RequestBody final Users user)`: Handles user registration.

*Fields:*
- `authManager : AuthenticationManager`: Authentication manager for handling login.
- `jwtService : JWTService`: Service for JWT operations.
- `userService : UserService`: Service for user operations.

=== 1.5 Users

*Purpose:* Entity representing a user.

*Annotations:*
- `@Entity`: Specifies that the class is an entity.
- `@Data`: Lombok annotation to generate getters, setters, and other typical methods.
- `@Id`: Specifies the primary key of an entity.
- `@GeneratedValue`: Provides for the specification of generation strategies for the values of primary keys.

*Methods:*
- `public String getPassword()`: Returns user's password.
- `public String getUsername()`: Returns user's username.

*Fields:*
- `userId : Long`: Unique identifier for the user.
- `username : String`: Username of the user.
- `password : String`: Password of the user.

=== 1.6 UserRepository

*Purpose:* Repository for accessing user data.

*Annotations:*
- `@Repository`: Indicates that the class is a repository, which is an abstraction of data access and storage.

=== 1.7 JWTService

*Purpose:* Service to handle JWT creation and validation.

*Annotations:*
- `@Service`: Indicates that the class is a service, a business logic holder.
- `@Slf4j`: Lombok annotation to provide a logger.

*Methods:*
- `public String extractUsername(String token)`: Extracts username from the JWT token.
- `public String generateToken(String username)`: Generates a JWT token for a given username.
- `public boolean validateToken(String token)`: Validates a given JWT token.

*Fields:*
- `secretKey : final Key`: The key used for signing JWT tokens.

=== 1.8 UserService

*Purpose:* Service to handle user-related operations.

*Annotations:*
- `@Service`: Indicates that the class is a service.
- `@Autowired`: Marks a dependency to be injected.

*Methods:*
- `public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException`: Loads user details by username.
- `public Users register(Users user)`: Registers a new user.

*Fields:*
- `encoder : BCryptPasswordEncoder`: Password encoder for encoding passwords.
- `userRepository : UserRepository`: Repository for user data access.

== 2. Runtime View Diagrams

=== 2.1 User Registration Flow

[plantuml, user-registration-sequence, png]
----
@startuml
actor User
participant UserController
participant UserService
participant UserRepository

User -> UserController : register(user)
UserController -> UserService : register(user)
UserService -> UserRepository : save(user)
UserRepository -> UserService : user
UserService -> UserController : user
UserController -> User : user
@enduml
----

=== 2.2 Authentication/Login Flow

[plantuml, authentication-sequence, png]
----
@startuml
actor User
participant UserController
participant AuthenticationManager
participant JWTService

User -> UserController : login(authRequest)
UserController -> AuthenticationManager : authenticate(authRequest)
AuthenticationManager -> UserController : authentication
UserController -> JWTService : generateToken(authentication)
JWTService -> UserController : jwtToken
UserController -> User : jwtToken
@enduml
----

=== 2.3 JWT Token Validation Flow

[plantuml, jwt-validation-sequence, png]
----
@startuml
actor User
participant JwtAuthFilter
participant JWTService

User -> JwtAuthFilter : request(resource)
JwtAuthFilter -> JWTService : validateToken(token)
JWTService -> JwtAuthFilter : isValid
JwtAuthFilter -> User : proceed / error
@enduml
----

== 3. Entity Relationship Diagram

[plantuml, entity-relationship-diagram, png]
----
@startuml
entity "Users" {
  * userId : Long
  --
  * username : String
  * password : String
}

@enduml
----

== 4. Detailed Component Interactions

=== 4.1 Controller-Service-Repository Interactions

- **UserController**:
  - Interacts with **UserService** to perform user registration and login.
  - Receives data from the user and passes it to services.
  - Returns response entities based on the outcomes of the service operations.

- **UserService**:
  - Interacts with **UserRepository** to access and persist user data.
  - Uses **BCryptPasswordEncoder** to encode passwords before saving to the database.

- **JWTService**:
  - Used by **UserController** to generate and validate JWT tokens.

=== 4.2 Exception Propagation

- Exceptions like `UsernameNotFoundException` are thrown by **UserService** and are handled globally by an exception handler to return appropriate HTTP responses.

=== 4.3 Transaction Boundaries

- Transactions are managed at the service layer, ensuring that database operations are completed successfully before committing the transaction.

This detailed design document provides a comprehensive overview for developers to understand and implement the Identity Provider Application effectively.