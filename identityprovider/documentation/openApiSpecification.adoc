= Identity Provider API Documentation

== Introduction

The Identity Provider API offers a set of endpoints for user authentication and management. This API allows clients to register new users, login existing users, and greet users. It is designed to be simple and straightforward for integration into various client applications.

=== Authentication Requirements

Most endpoints require JWT-based authentication. Clients must authenticate by providing a valid JWT token in the `Authorization` header of their requests.

=== Base URL and Versioning

The base URL for all API endpoints is `https://api.example.com/v1`. This documentation refers to version 1 of the API.

=== How to Use This Specification

This document is structured according to the OpenAPI 3.0 specification. It can be imported into tools like Swagger UI, Postman, or Insomnia for interactive exploration and testing of the API endpoints.

== OpenAPI 3.0 YAML Specification

[source,yaml]
----
openapi: 3.0.0
info:
  title: Identity Provider API
  version: 1.0.0
  description: API for managing user authentication and registration.
servers:
  - url: https://api.example.com/v1
    description: Production server

paths:
  /login:
    post:
      summary: Logs in a user
      operationId: loginUser
      tags:
        - User
      requestBody:
        description: User login credentials
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /register:
    post:
      summary: Registers a new user
      operationId: registerUser
      tags:
        - User
      requestBody:
        description: User registration data
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Users'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /greet:
    get:
      summary: Greets the user
      operationId: greetUser
      tags:
        - User
      responses:
        '200':
          description: Greeting message returned
          content:
            text/plain:
              schema:
                type: string

components:
  schemas:
    AuthRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    AuthResponse:
      type: object
      properties:
        token:
          type: string
    Users:
      type: object
      properties:
        userId:
          type: integer
          format: int64
        username:
          type: string
        password:
          type: string
    Error:
      type: object
      properties:
        message:
          type: string
        code:
          type: integer

security:
  - bearerAuth: []

securitySchemes:
  bearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
----

== API Documentation

=== Endpoint Descriptions and Usage Examples

==== Login

Endpoint: `POST /login`

Description: Authenticates a user and returns a JWT token.

Request:
[source,json]
----
{
  "username": "user@example.com",
  "password": "password123"
}
----

Response:
[source,json]
----
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
----

==== Register

Endpoint: `POST /register`

Description: Registers a new user in the system.

Request:
[source,json]
----
{
  "username": "newuser@example.com",
  "password": "newpassword123"
}
----

Response:
[source,json]
----
{
  "userId": 1,
  "username": "newuser@example.com"
}
----

==== Greet

Endpoint: `GET /greet`

Description: Returns a greeting message.

Response:
[source,text]
----
Hello, welcome to our service!
----

=== Authentication Flows

JWT tokens must be included in the `Authorization` header as `Bearer <token>`. These tokens are obtained through the login endpoint.

=== Common Error Codes and Their Meanings

- `401 Unauthorized`: Authentication failed due to invalid credentials or token.
- `400 Bad Request`: The request was malformed or missing required fields.

=== Rate Limiting Information

Currently, there is no rate limiting enforced on the API endpoints. However, future versions may include rate limiting policies to ensure fair usage.