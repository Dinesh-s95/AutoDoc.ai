= Identity Provider API Documentation

== Introduction

The Identity Provider API provides endpoints for user authentication and registration. This API is designed to facilitate secure access and identity management for applications.

=== Authentication Requirements
All sensitive endpoints require a valid JSON Web Token (JWT) for access. The token must be provided in the `Authorization` header as a Bearer token.

=== Base URL and Versioning
The API is accessible at `https://api.example.com/v1`. This document describes version 1 of the API.

=== How to Use This Specification
This OpenAPI specification is designed to be used with tools that support the OpenAPI 3.0 format, such as Swagger UI, Postman, and Insomnia. You can import this YAML into any of these tools to interact with the API or generate client code.

== OpenAPI 3.0 YAML Specification

[source,yaml]
----
openapi: 3.0.0
info:
  title: Identity Provider API
  version: 1.0.0
  description: API for user authentication and registration.
servers:
  - url: https://api.example.com/v1
    description: Production server

paths:
  /login:
    post:
      summary: User login
      description: Authenticates a user and returns a JWT.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /register:
    post:
      summary: Register a new user
      description: Registers a new user in the system.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Users'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    AuthRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password

    AuthResponse:
      type: object
      properties:
        token:
          type: string

    Users:
      type: object
      properties:
        userId:
          type: integer
          format: int64
        username:
          type: string
        password:
          type: string

    Error:
      type: object
      properties:
        message:
          type: string
        code:
          type: integer

security:
  - bearerAuth: []

securitySchemes:
  bearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
----

== API Documentation

=== Endpoint Descriptions and Usage Examples

==== Login

Endpoint: `POST /login`

Description: Authenticates a user by their username and password, returning a JWT if successful.

.Request Example
[source,json]
----
{
  "username": "user@example.com",
  "password": "password123"
}
----

.Response Example (200 OK)
[source,json]
----
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
----

==== Register

Endpoint: `POST /register`

Description: Registers a new user with a username and password.

.Request Example
[source,json]
----
{
  "username": "newuser@example.com",
  "password": "newpassword123"
}
----

.Response Example (201 Created)
[source,json]
----
{
  "userId": 1,
  "username": "newuser@example.com"
}
----

=== Authentication Flows

To access protected endpoints, use the JWT obtained from the `/login` endpoint. Include this token as a Bearer token in the `Authorization` header of subsequent requests.

=== Common Error Codes and Their Meanings

- `401 Unauthorized`: Authentication failed due to invalid credentials or token.
- `400 Bad Request`: The request was malformed or missing required fields.
- `500 Internal Server Error`: An unexpected error occurred on the server.

=== Rate Limiting Information

Currently, there is no rate limiting enforced on the API endpoints. However, this may be subject to change as the API evolves.