= Identity Provider API Documentation

== Introduction

The Identity Provider API provides a set of RESTful services for user authentication and management. This API allows clients to register users, log in, and access user greetings. It is designed for applications requiring user authentication and token management.

=== Authentication Requirements

The API uses JWT (JSON Web Tokens) for securing endpoints. Clients must authenticate by providing a valid JWT in the `Authorization` header of their HTTP requests.

=== Base URL and Versioning

The base URL for all API endpoints is `https://api.example.com/v1`. This API is currently at version 1.

=== How to Use This Specification

This document is formatted according to the OpenAPI 3.0 specification. It can be imported into tools like Swagger UI, Postman, or Insomnia for interactive exploration and testing of the API endpoints.

== OpenAPI 3.0 YAML Specification

[source,yaml]
----
openapi: 3.0.0
info:
  title: Identity Provider API
  version: 1.0.0
  description: API for user authentication and management.
servers:
  - url: https://api.example.com/v1
paths:
  /login:
    post:
      summary: Logs in a user
      operationId: loginUser
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /greet:
    get:
      summary: Returns a greeting
      operationId: greetUser
      tags:
        - User
      responses:
        '200':
          description: Successful greeting
          content:
            text/plain:
              schema:
                type: string
  /register:
    post:
      summary: Registers a new user
      operationId: registerUser
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Users'
      responses:
        '201':
          description: User registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Users'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    AuthRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    AuthResponse:
      type: object
      properties:
        token:
          type: string
    Users:
      type: object
      properties:
        userId:
          type: integer
          format: int64
        username:
          type: string
        password:
          type: string
    Error:
      type: object
      properties:
        message:
          type: string
security:
  - bearerAuth: []
securitySchemes:
  bearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
----

== API Documentation

=== Endpoint Descriptions and Usage Examples

==== Login

Endpoint: `POST /login`

Description: Authenticates a user and returns a JWT.

Request:
[source,json]
----
{
  "username": "user1",
  "password": "password123"
}
----

Response:
[source,json]
----
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
----

==== Greet

Endpoint: `GET /greet`

Description: Returns a simple greeting message.

Response:
[source]
----
Hello, user!
----

==== Register User

Endpoint: `POST /register`

Description: Registers a new user in the system.

Request:
[source,json]
----
{
  "username": "newuser",
  "password": "newpassword123"
}
----

Response:
[source,json]
----
{
  "userId": 101,
  "username": "newuser"
}
----

=== Authentication Flows

Authentication is performed via JWT. Users must first authenticate through the `/login` endpoint to receive a token. This token must be included in the `Authorization` header as `Bearer <token>` for subsequent requests to secured endpoints.

=== Common Error Codes

- `401 Unauthorized`: The request lacks valid authentication credentials.
- `400 Bad Request`: The request is malformed or missing required parameters.

=== Rate Limiting Information

Currently, there is no rate limiting enforced on the API endpoints. However, this may be subject to change as the API evolves.