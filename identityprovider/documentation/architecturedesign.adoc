= Identity Provider Service Architecture Design

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

The following PlantUML diagram represents the high-level system architecture, including the main components and their interactions within the Identity Provider application.

[plantuml, diagram-architecture, png]
----
@startuml
skinparam componentStyle uml2

package "Identity Provider Application" {
    [IdentityproviderApplication] as app
    [UserController] as controller
    [UserService] as service
    [UserRepository] as repository
    [JWTService] as jwtService
    [SecurityConfig] as security
    [JwtAuthFilter] as jwtFilter

    app --> controller
    controller --> service
    service --> repository
    controller --> jwtService
    security --> jwtFilter
    jwtFilter --> service
}

[UserDetails] as userDetails
[AuthenticationManager] as authManager
[HttpSecurity] as httpSecurity

controller --> userDetails : uses
controller --> authManager : uses
security --> authManager : configures
security --> httpSecurity : configures

@enduml
----

=== External System Connections and Integrations

The Identity Provider application integrates with the following external systems:

- **Database System**: For user data storage and retrieval.
- **Authentication Systems**: External services for additional authentication mechanisms (e.g., OAuth providers).

=== Component Interaction Overview

Components interact primarily through Spring-managed beans:

- `UserController` handles incoming HTTP requests and interacts with `UserService` for business operations.
- `UserService` accesses `UserRepository` for data persistence.
- `JWTService` is used by `UserController` to generate and validate JWT tokens.
- `JwtAuthFilter` intercepts requests to validate JWT tokens using `UserService`.
- `SecurityConfig` sets up security configurations and beans like `AuthenticationManager`.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based Applications.
- **Spring Security**: For authentication and access-control.
- **Spring Data JPA**: For database operations.
- **JWT**: For stateless authentication.
- **MySQL**: As the database backend.
- **JUnit**: For unit testing.

== 2. Component Description

=== IdentityproviderApplication

- **Responsibility**: Bootstraps the Spring Boot application.
- **Role**: Entry point of the application.
- **Interactions**: Initializes all Spring components.

=== UserController

- **Responsibility**: Handle HTTP requests related to user authentication and management.
- **Role**: Controller in MVC pattern.
- **Interactions**: Uses `UserService` for business operations and `JWTService` for token operations.

=== UserService

- **Responsibility**: Business logic for user management.
- **Role**: Service layer component.
- **Interactions**: Interacts with `UserRepository` for database operations.

=== UserRepository

- **Responsibility**: Interface for database operations related to `Users`.
- **Role**: Repository layer component.
- **Interactions**: Used by `UserService` for data persistence.

=== JWTService

- **Responsibility**: Handling JWT token operations.
- **Role**: Service component.
- **Interactions**: Used by `UserController` for creating and validating tokens.

=== JwtAuthFilter

- **Responsibility**: Filter to intercept requests and validate JWT tokens.
- **Role**: Security filter.
- **Interactions**: Uses `UserService` to load user details during authentication.

=== SecurityConfig

- **Responsibility**: Configuration of security settings.
- **Role**: Configuration component.
- **Interactions**: Sets up `AuthenticationManager` and security filters.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for better scalability and management.

=== Database Architecture

The application uses MySQL as its relational database. It stores user credentials and authorities. The database schema is managed through Hibernate ORM with Spring Data JPA.

=== Security Architecture

- **Authentication**: Uses JWT for stateless session management.
- **Authorization**: Spring Security for role-based access control.
- **Data Encryption**: Uses HTTPS for secure data transmission and bcrypt for password hashing.

=== Network Architecture

The application is deployed within a VPC with restricted access to the database and other internal resources. Only HTTP(S) ports are exposed, and access is controlled through security groups.

== 4. System Context

=== External Systems and Their Interfaces

- **Database**: Connects via JDBC with transaction management handled by Spring.
- **OAuth Providers**: Integration via HTTP/HTTPS for OAuth-based authentication.

=== Data Flow Between Systems

1. User sends login credentials.
2. Application validates credentials and generates JWT.
3. User accesses protected resources with JWT.
4. JWT is validated on each request by `JwtAuthFilter`.

=== Authentication and Authorization Flows at System Level

- **Authentication Flow**: User credentials are authenticated using `UserService`, and a JWT is issued upon successful authentication.
- **Authorization Flow**: JWTs are validated and decoded to establish user identity and roles with each request, managed by `JwtAuthFilter`.

This document provides a comprehensive overview of the Identity Provider application's architecture, designed for understanding by architects and senior developers.