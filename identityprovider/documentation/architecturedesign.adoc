= Identity Provider Service Architecture Documentation

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, "system-architecture", png]
....
@startuml
package "Identity Provider Application" {
  [IdentityproviderApplication] as app
  [UserController] as controller
  [UserService] as userService
  [JWTService] as jwtService
  [SecurityConfig] as securityConfig
  [JwtAuthFilter] as jwtFilter
  [UserRepository] as userRepository
  [EmailService] as emailService
  [AuditService] as auditService
  [TokenBlacklistService] as tokenBlacklistService
  [NotificationService] as notificationService
}

database "Database" {
  [Client]
  [User]
  [Role]
  [Token]
}

app --> controller
controller --> userService
userService --> userRepository
userService --> emailService
userService --> auditService
jwtService --> tokenBlacklistService
jwtService --> auditService
jwtFilter --> jwtService
securityConfig --> jwtFilter
emailService --> notificationService
userRepository --> [Database]
@enduml
....

=== External System Connections and Integrations

The Identity Provider Application integrates with the following external systems:
- **Email System**: For sending out welcome emails and notifications.
- **Audit System**: For logging security and operational events.

=== Component Interaction Overview

Components interact primarily through Spring-managed beans. `UserController` handles HTTP requests and leverages `UserService` for user management operations. `JWTService` is used for token management and interacts with `TokenBlacklistService` for token invalidation. `SecurityConfig` sets up security filters and authentication mechanisms.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based Applications.
- **Spring Security**: For authentication and access-control.
- **JWT**: JSON Web Tokens for secure transmission of information.
- **Hibernate**: For ORM and database interaction.
- **MySQL**: Database for storing user data and authentication tokens.
- **Maven**: For project management and build automation.

== 2. Component Description

=== IdentityproviderApplication

* **Responsibility**: Serves as the bootstrap class that runs the Spring Boot application.
* **Role**: Entry point of the application.
* **Interactions**: Initializes the Spring context and all other components.

=== UserController

* **Responsibility**: Handles all user-related HTTP requests.
* **Role**: Controller in the MVC pattern.
* **Interactions**: Uses `UserService` for business operations and `JWTService` for token operations.

=== UserService

* **Responsibility**: Manages all operations related to user data.
* **Role**: Service layer that abstracts the logic related to user management.
* **Interactions**: Interacts with `UserRepository` for database operations and `EmailService` for sending emails.

=== JWTService

* **Responsibility**: Manages token creation, validation, and invalidation.
* **Role**: Service layer for handling JWT operations.
* **Interactions**: Uses `AuditService` for logging and `TokenBlacklistService` for managing blacklisted tokens.

=== SecurityConfig

* **Responsibility**: Configures security settings for the application.
* **Role**: Security configuration.
* **Interactions**: Sets up `JwtAuthFilter` and authentication mechanisms.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing for deployment on any system that supports Docker. This includes local development environments, on-premise servers, and cloud platforms.

=== Database Architecture

The application uses MySQL as its relational database. It stores tables for `Users`, `Roles`, `Tokens`, and `Clients`, with appropriate relationships configured via Hibernate.

=== Security Architecture

Security is managed using Spring Security with JWT for authentication. Passwords are stored in hashed form using BCrypt. HTTPS is enforced for all interactions.

=== Network Architecture

The application is typically deployed within a private network with controlled access. Only specific ports are exposed, and access to the database is restricted to the application itself.

== 4. System Context

=== External Systems and Their Interfaces

- **Email System**: Interfaced via SMTP protocol.
- **Audit System**: Logs are sent using a REST API or a logging framework like Logstash.

=== Data Flow Between Systems

1. User data flows from `UserController` to `UserService` and then to `UserRepository`.
2. Authentication data flows from `UserController` to `JWTService` for token generation and validation.

=== Authentication and Authorization Flows at System Level

Authentication is performed using JWT tokens. Users submit credentials via the `/login` endpoint, receive a token, and use this token for subsequent requests. Authorization is managed using Spring Security roles and permissions.

This documentation provides a comprehensive overview of the Identity Provider Application's architecture, suitable for architects and senior developers to understand and extend the system.