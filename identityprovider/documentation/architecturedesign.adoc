= Identity Provider System Architecture Design

:toc:
:toc-placement: auto
:toc-title: Table of Contents
:sectnums:
:sectnumlevels: 5
:icons: font

== Overview

This document provides a comprehensive architecture design for the Identity Provider System developed using Java Spring Boot. It outlines the system's service architecture, component descriptions, infrastructure architecture, and the system context including external integrations.

== Service Architecture Overview

=== High-Level System Architecture Diagram

[plantuml, "system_architecture_diagram", png]
....
@startuml
package "Identity Provider Application" {
  [IdentityproviderApplication] as IApp
  [UserController] as UC
  [SecurityConfig] as SC
  [JwtAuthFilter] as JF
  [UserService] as US
  [JWTService] as JS
  [UserRepository] as UR
  [AuditService] as AS
  [EmailService] as ES
  [NotificationService] as NS
  [TokenBlacklistService] as TBS

  IApp --> UC
  IApp --> SC
  UC --> US : uses
  SC --> JF : configures
  JF --> US : validates users
  US --> UR : CRUD operations
  US --> JS : token operations
  US --> AS : logging
  US --> ES : sends emails
  ES --> NS : notification
  JS --> TBS : token management
}

package "External Systems" {
  [Database] as DB
  [SMTP Server] as SMTP
  [Web Clients] as WC
}

DB <-- UR : data storage
SMTP <-- ES : email sending
WC --> UC : user interactions
@enduml
....

=== External System Connections and Integrations

The Identity Provider System integrates with the following external systems:

- **Database**: For persistent storage of user data, roles, tokens, and client information.
- **SMTP Server**: For sending out email notifications through the `EmailService`.
- **Web Clients**: Clients interact with the system through exposed REST APIs for user registration and login.

=== Component Interaction Overview

Components within the system interact primarily through Spring-managed beans. `UserController` handles incoming HTTP requests and interacts with `UserService` for user-related operations. `UserService` accesses the database through `UserRepository` and uses `JWTService` for token management. Security configurations are centralized in `SecurityConfig`, which applies `JwtAuthFilter` for securing endpoints.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring-based applications.
- **Spring Security**: For authentication and authorization.
- **JWT (JSON Web Token)**: For secure transmission of information between parties as a JSON object.
- **Hibernate**: For ORM-based database operations.
- **MySQL**: As the relational database.
- **Maven**: For dependency management and build automation.

== Component Description

=== IdentityproviderApplication

The entry point of the application, responsible for bootstrapping and launching the Spring Boot application.

=== UserController

Handles all user-related operations exposed via REST endpoints. It interacts with `AuthenticationManager` for authenticating requests and `UserService` for user registration and querying.

=== SecurityConfig

Configures security aspects of the application, including URL access policies and configures `JwtAuthFilter` for processing JWTs in HTTP requests.

=== JwtAuthFilter

A filter that intercepts HTTP requests to check for the presence of a valid JWT in the HTTP header.

=== UserService

Provides business services related to user management, such as user registration and loading user details. It interacts with `UserRepository` for database operations and `JWTService` for token management.

=== JWTService

Responsible for all operations related to JWT, including token generation, extraction, validation, and invalidation.

=== UserRepository, AuditService, EmailService, NotificationService, TokenBlacklistService

These components provide supporting functionalities such as data access, auditing, email notifications, and token blacklist management.

== Infrastructure Architecture

=== Deployment Architecture

The application is packaged as a jar and can be deployed on any Java-capable server environment. Docker containers can be used for isolating the application and managing dependencies.

=== Database Architecture

Uses MySQL as the database with tables for `Users`, `Roles`, `Tokens`, and `Clients`. Hibernate ORM is used for database interactions.

=== Security Architecture

Utilizes Spring Security for authentication and authorization. Passwords are stored in hashed formats, and JWTs are used for stateless authentication.

=== Network Architecture

The application is deployed within a secure network environment with firewalls configured to allow only HTTPS traffic. Internal communications between application components can be secured using Spring Cloud Security.

== System Context

=== External Systems and Their Interfaces

The system interacts with a database for storage, an SMTP server for sending emails, and web clients for user interactions through REST APIs.

=== Data Flow Between Systems

User data flows from web clients to `UserController`, which interacts with `UserService` to perform operations. `UserService` interacts with the database through `UserRepository` and handles email notifications via `EmailService`.

=== Authentication and Authorization Flows at System Level

Authentication is handled using Spring Security, where `JwtAuthFilter` checks for valid JWTs. Authorization is managed using roles stored in the database and checked during each request.

This architecture document provides a detailed overview of the Identity Provider System, designed to be scalable, secure, and maintainable, suitable for understanding by architects and senior developers.