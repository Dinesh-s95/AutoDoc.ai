= Identity Provider Service Architecture Design Document

== Version Details
- *Version*: 1.0
- *Date*: 2023-12-01
- *Author*: [Your Name]

== 1. Service Architecture Overview

=== 1.1 High-level System Architecture Diagram

[plantuml, "system-architecture", png]
....
@startuml
package "Identity Provider Application" {
  [IdentityproviderApplication] as App
  [UserController] as UC
  [UserService] as US
  [JWTService] as JWT
  [UserRepository] as UR
  [SecurityConfig] as SC
  [JwtAuthFilter] as JAF
}
 
database "Database" {
  [Users]
}

node "External Systems" {
  [Authentication Provider]
}

App --> UC : uses
UC --> US : uses
US --> UR : uses
UC --> JWT : uses
SC --> JAF : configures
SC --> US : configures
UR --> [Users] : accesses
[Authentication Provider] --> SC : authenticates
@enduml
....

=== 1.2 External System Connections and Integrations

The system integrates with an external *Authentication Provider* for validating user credentials and managing security tokens.

=== 1.3 Component Interaction Overview

Components interact primarily through service invocations. `UserController` manages incoming HTTP requests and communicates with `UserService` for user operations and `JWTService` for token operations. `UserService` accesses `UserRepository` for database operations.

=== 1.4 Technology Stack and Frameworks Used

- **Programming Language**: Java
- **Framework**: Spring Boot
- **Security**: Spring Security, JWT
- **Database**: MySQL
- **Build Tool**: Maven

== 2. Component Description

=== 2.1 IdentityproviderApplication

- *Responsibility*: Bootstraps the Spring Boot application.
- *Role*: Entry point of the application.

=== 2.2 JwtAuthFilter

- *Responsibility*: Intercepts HTTP requests to validate JWT tokens.
- *Role*: Security filter to ensure that only authenticated requests proceed.
- *Interaction*: Uses `UserService` to load user details during authentication.

=== 2.3 SecurityConfig

- *Responsibility*: Configures security settings for the application.
- *Role*: Defines beans for authentication and authorization mechanisms.
- *Interaction*: Sets up `JwtAuthFilter` and configures `UserDetailsService`.

=== 2.4 UserController

- *Responsibility*: Handles all user-related HTTP requests.
- *Role*: Controller to manage login and registration endpoints.
- *Interaction*: Uses `AuthenticationManager` and `JWTService` for authenticating users and managing JWT tokens, respectively.

=== 2.5 Users

- *Responsibility*: Represents the user entity in the database.
- *Role*: Domain model for user data.

=== 2.6 UserRepository

- *Responsibility*: Interface for database operations related to `Users`.
- *Role*: Spring Data repository that abstracts CRUD operations.

=== 2.7 JWTService

- *Responsibility*: Manages operations related to JWT including token generation and validation.
- *Role*: Service layer component for encapsulating JWT handling.

=== 2.8 UserService

- *Responsibility*: Manages business logic related to users.
- *Role*: Service layer component that interacts with `UserRepository` and provides user details to Spring Security.

== 3. Infrastructure Architecture

=== 3.1 Deployment Architecture

The application is containerized using Docker and deployed on Kubernetes for orchestration. This setup provides scalability and resilience.

=== 3.2 Database Architecture

The application uses MySQL as its relational database, with a single table `Users` that stores user credentials and information.

=== 3.3 Security Architecture

Security is managed using Spring Security with JWT for stateless authentication. HTTPS is enforced for all communications.

=== 3.4 Network Architecture

The application is deployed within a VPC with restricted access to the database and external interfaces. Only specific ports are exposed for HTTP and HTTPS traffic.

== 4. System Context

=== 4.1 External Systems and Their Interfaces

The system interfaces with an external *Authentication Provider* which supports OAuth2 for user authentication.

=== 4.2 Data Flow Between Systems

User credentials are verified against the external Authentication Provider during the login process. Upon successful authentication, a JWT is generated and returned to the user.

=== 4.3 Authentication and Authorization Flows at System Level

Authentication is handled via JWT tokens. The `JwtAuthFilter` checks for the presence of a valid JWT in the HTTP request headers. If the token is valid, the request is allowed to proceed; otherwise, it is rejected.

== Document Revision History

|===
| Version | Date       | Description

| 1.0     | 2023-12-01 | Initial release
|===

This document provides a comprehensive overview of the architecture for the Identity Provider application, designed for use by architects and senior developers to understand and maintain the system.