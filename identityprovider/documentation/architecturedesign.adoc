= Identity Provider Service Architecture Design

This document provides a comprehensive architecture design for the Identity Provider Service, a Java Spring Boot application designed to handle user authentication and authorization.

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
package "Spring Boot Application" {
    component [IdentityproviderApplication] as App
    component [UserController] as UC
    component [SecurityConfig] as SC
    component [JwtAuthFilter] as JF
    component [JWTService] as JS
    component [UserService] as US
    database [UserRepository] as UR

    App --> UC
    UC --> SC
    SC --> JF
    JF --> JS
    UC --> JS
    UC --> US
    US --> UR
}

node "External Systems" {
    [Authentication Database] as AuthDB
}

UR --> AuthDB : "JDBC\nConnection"
@enduml
----

=== External System Connections and Integrations

The Identity Provider Service integrates with the following external systems:

- **Authentication Database**: This is a relational database where user credentials and details are stored. The connection is managed via JDBC.

=== Component Interaction Overview

Components within the Identity Provider Service interact primarily through Spring-managed beans. `UserController` manages all incoming HTTP requests related to user authentication and forwards these requests to `SecurityConfig` for security checks. `JwtAuthFilter` applies JWT-based authentication mechanisms provided by `JWTService`. `UserService` handles all business logic related to user data and interacts with `UserRepository` for data persistence.

=== Technology Stack and Frameworks Used

- **Java**: Programming language
- **Spring Boot**: Application framework
- **Spring Security**: Security framework for authentication and authorization
- **JWT**: JSON Web Tokens for secure transmission of user credentials
- **Hibernate**: ORM framework for database operations
- **MySQL**: Database for storing user data
- **JUnit**: Framework for unit testing

== 2. Component Description

=== IdentityproviderApplication

- **Responsibility**: Bootstraps the Spring Boot application.
- **Role**: Entry point of the application.
- **Interactions**: Initiates the Spring ApplicationContext.

=== UserController

- **Responsibility**: Handles all user-related HTTP requests.
- **Role**: Controller in MVC pattern.
- **Interactions**: Uses `AuthenticationManager` for authentication, `JWTService` for token operations, and `UserService` for user management.

=== SecurityConfig

- **Responsibility**: Configures security settings for the application.
- **Role**: Security configuration.
- **Interactions**: Defines beans for `AuthenticationManager`, `AuthenticationProvider`, and `SecurityFilterChain`.

=== JwtAuthFilter

- **Responsibility**: Filters incoming requests for JWT validation.
- **Role**: Security filter in Spring Security.
- **Interactions**: Uses `JWTService` to validate tokens and `UserService` to load user details.

=== JWTService

- **Responsibility**: Manages all operations related to JWT.
- **Role**: Service provider for JWT operations.
- **Interactions**: Generates, extracts, and validates JWT tokens.

=== UserService

- **Responsibility**: Manages business logic related to users.
- **Role**: Service layer component.
- **Interactions**: Interacts with `UserRepository` for data persistence.

=== UserRepository

- **Responsibility**: Interface for database operations related to users.
- **Role**: Repository in the repository pattern.
- **Interactions**: Communicates with the database to perform CRUD operations.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for better scalability and management.

=== Database Architecture

The application uses MySQL as its database. The `UserRepository` handles all interactions with this database using Spring Data JPA.

=== Security Architecture

Security is managed using Spring Security, configuring HTTP session management, CSRF protection, and CORS policies. Passwords are stored in hashed form using BCrypt.

=== Network Architecture

The application is designed to be deployed within a private network with controlled access to the internet. Communication between the application and external systems must be encrypted using TLS.

== 4. System Context

=== External Systems and Their Interfaces

- **Authentication Database**: Accessed via JDBC with secured credentials.

=== Data Flow Between Systems

User credentials are received at the `UserController`, processed for authentication, and verified against stored hashes in the database. Validated users receive a JWT for subsequent requests.

=== Authentication and Authorization Flows at System Level

Authentication is performed using username and password against stored credentials in the database. Upon successful authentication, a JWT is issued which is used for authorization in subsequent requests.

This architecture document outlines the design and interaction of components within the Identity Provider Service, providing a clear overview for architects and senior developers.