= Identity Provider System Architecture Design

This document provides a comprehensive overview of the architecture for the Identity Provider system built using Java Spring Boot. The system is designed to manage user authentication and authorization through a secure and scalable approach.

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, "system-architecture-diagram", png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #FFD700
!define SERVICE #ADD8E6
!define CONTROLLER #FF6347

package "Spring Boot Application" {
  [IdentityproviderApplication] << SPRING >>
}

package "Web Layer" {
  [UserController] << CONTROLLER >>
}

package "Security" {
  [JwtAuthFilter] << SPRING >>
  [SecurityConfig] << SPRING >>
}

package "Service Layer" {
  [UserService] << SERVICE >>
  [JWTService] << SERVICE >>
  [AuditService] << SERVICE >>
  [EmailService] << SERVICE >>
  [NotificationService] << SERVICE >>
  [TokenBlacklistService] << SERVICE >>
}

package "Data Layer" {
  [UserRepository] << SPRING >>
  [User] << ENTITY >>
  [Role] << ENTITY >>
  [Client] << ENTITY >>
  [Token] << ENTITY >>
}

[UserController] --> [UserService]
[UserController] --> [JWTService]
[UserService] --> [UserRepository]
[UserService] --> [AuditService]
[UserService] --> [EmailService]
[JwtAuthFilter] --> [JWTService]
[JWTService] --> [TokenBlacklistService]
[JWTService] --> [AuditService]
[EmailService] --> [NotificationService]

@enduml
----

=== External System Connections and Integrations

The Identity Provider system integrates with external email systems for sending notifications and with various client applications for authentication and authorization services.

=== Component Interaction Overview

The system is structured around the core Spring Boot application (`IdentityproviderApplication`) which orchestrates interactions across various components:

- **Web Layer**: Handles HTTP requests and responses.
- **Security**: Manages authentication and security configurations.
- **Service Layer**: Contains business logic and service orchestration.
- **Data Layer**: Manages data persistence and retrieval operations.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based applications.
- **Spring Security**: For authentication and access-control.
- **JWT (JSON Web Tokens)**: For secure transmission of information between parties as a JSON object.
- **Hibernate**: For ORM and database interaction.
- **MySQL**: As the relational database.
- **JUnit**: For unit testing.

== 2. Component Description

=== IdentityproviderApplication

The entry point of the Spring Boot application, responsible for bootstrapping and launching the application.

=== JwtAuthFilter

A filter that intercepts requests to validate JWT tokens in the HTTP headers of incoming requests.

=== SecurityConfig

Configures security aspects of the application, such as authentication managers, security filters, and password encoding.

=== UserController

Handles all user-related operations exposed via REST endpoints, such as user registration and login.

=== UserService

Contains business logic related to user management, including user registration and loading user details.

=== JWTService

Manages all operations related to JWT, including token generation, extraction, validation, and invalidation.

=== UserRepository

Interface for database operations related to the `User` entity.

=== AuditService, EmailService, NotificationService, TokenBlacklistService

Services for logging events, sending emails, sending notifications, and managing blacklisted tokens, respectively.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for better scalability and management.

=== Database Architecture

MySQL is used as the database, with entities such as `User`, `Role`, `Client`, and `Token` mapped via Hibernate ORM.

=== Security Architecture

Security is enforced via Spring Security, using JWT for stateless authentication. Passwords are stored in hashed formats using BCrypt.

=== Network Architecture

The application is deployed within a private subnet with controlled access via load balancers. Only HTTPS traffic is permitted, ensuring encrypted data transfers.

== 4. System Context

=== External Systems and Their Interfaces

The system interacts with:
- **Email Systems**: For sending out notification emails.
- **Client Applications**: Various clients that integrate using standard OAuth2 flows.

=== Data Flow Between Systems

Data flows primarily between the user clients and the Identity Provider system via secure REST APIs, with JWTs facilitating secure stateless sessions.

=== Authentication and Authorization Flows at System Level

Authentication is handled using JWTs where the `UserController` authenticates users and issues tokens. Authorization is managed via roles and permissions encoded within the JWT.

This architecture document outlines the high-level design and component interactions within the Identity Provider system, providing a clear map for development and further enhancements.