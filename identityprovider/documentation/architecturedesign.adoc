= Identity Provider Service Architecture Design

This document provides a comprehensive architecture design for the Identity Provider service, detailing the service architecture, component descriptions, infrastructure, and system context.

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-architecture, png]
----
@startuml
!define SPRING #SpringGreen
!define ENTITY #MistyRose
!define SERVICE #SkyBlue

package "Identity Provider Application" {
  [IdentityproviderApplication] <<SPRING>>
  package "Security" {
    [JwtAuthFilter] <<SPRING>>
    [SecurityConfig] <<SPRING>>
  }
  package "Controllers" {
    [UserController] <<SPRING>>
  }
  package "Services" {
    [UserService] <<SERVICE>>
    [JWTService] <<SERVICE>>
    [AuditService] <<SERVICE>>
    [EmailService] <<SERVICE>>
    [NotificationService] <<SERVICE>>
    [TokenBlacklistService] <<SERVICE>>
  }
  package "Entities" {
    [User] <<ENTITY>>
    [Role] <<ENTITY>>
    [Client] <<ENTITY>>
    [Token] <<ENTITY>>
  }
  [UserRepository] <<SPRING>>
}

[IdentityproviderApplication] --> [UserController]
[UserController] --> [UserService]
[UserService] --> [UserRepository]
[UserService] --> [AuditService]
[UserService] --> [EmailService]
[UserService] --> [JWTService]
[JwtAuthFilter] --> [UserService]
[JWTService] --> [TokenBlacklistService]
[JWTService] --> [AuditService]
[EmailService] --> [NotificationService]
[SecurityConfig] --> [JwtAuthFilter]

@enduml
----

=== External System Connections and Integrations

The Identity Provider service integrates with the following external systems:
- **Email System**: For sending notifications and welcome emails.
- **Audit System**: For logging security and operational events.

=== Component Interaction Overview

Components interact primarily through Spring-managed beans. `UserController` handles incoming HTTP requests, utilizing `UserService` for user management, which in turn interacts with `UserRepository` for data persistence. Security aspects are managed by `SecurityConfig` which integrates `JwtAuthFilter` for JWT token handling.

=== Technology Stack and Frameworks Used

- **Programming Language**: Java
- **Framework**: Spring Boot
- **Security**: Spring Security, JWT
- **Database**: MySQL
- **Build Tool**: Maven
- **Version Control**: Git

== 2. Component Description

=== IdentityproviderApplication

The entry point of the application, responsible for bootstrapping and launching the Spring Boot application.

=== JwtAuthFilter

A filter that intercepts HTTP requests to validate JWT tokens for secured endpoints.

=== SecurityConfig

Configures web security, declaring beans for authentication and authorization mechanisms.

=== UserController

Handles all user-related HTTP requests such as login, registration, and token refresh operations.

=== UserService

Provides business logic for user management and interacts with the `UserRepository` for data persistence.

=== JWTService

Manages JWT token creation, validation, and invalidation, and logs token-related activities through `AuditService`.

=== AuditService, EmailService, NotificationService, TokenBlacklistService

These services provide auxiliary functionality such as auditing, email notifications, and token blacklisting.

=== Entities (User, Role, Client, Token)

Domain models representing the data managed by the application, persisted in a relational database system.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker and deployed on Kubernetes for orchestration, ensuring scalability and high availability.

=== Database Architecture

MySQL is used as the relational database, with entities such as `User`, `Role`, `Client`, and `Token` mapped to corresponding tables.

=== Security Architecture

Utilizes Spring Security for authentication and authorization, with JWT for secure stateless authentication.

=== Network Architecture

Deployed within a VPC with restricted access, only exposing necessary ports to the internet via a load balancer.

== 4. System Context

=== External Systems and Their Interfaces

- **Email System**: Accessed via SMTP protocol.
- **Audit System**: Integrated via REST API for event logging.

=== Data Flow Between Systems

User data flows from `UserController` to `UserService`, then to `UserRepository` and the database. Authentication data flows through `JwtAuthFilter` and `SecurityConfig`.

=== Authentication and Authorization Flows at System Level

Authentication is managed using JWT tokens generated by `JWTService`. Authorization is enforced by Spring Security configurations in `SecurityConfig`.

