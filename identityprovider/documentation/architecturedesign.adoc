= Identity Provider Service Architecture Design Document

== 1. Service Architecture Overview

=== High-level System Architecture Diagram

[plantuml, diagram-arch, png]
....
@startuml
skinparam componentStyle uml2

package "Identity Provider Application" {
  [IdentityproviderApplication] as App
  [UserController]
  [JwtAuthFilter]
  [SecurityConfig]
  [UserService]
  [JWTService]
  [AuditService]
  [EmailService]
  [TokenBlacklistService]
  [NotificationService]
  [UserRepository]
}

database "Database" {
  [Users]
  [Client]
  [Role]
  [Token]
}

[App] ..> [UserController] : uses
[UserController] ..> [UserService] : uses
[UserService] ..> [UserRepository] : uses
[UserService] ..> [EmailService] : uses
[UserService] ..> [AuditService] : uses
[JwtAuthFilter] ..> [UserService] : uses
[SecurityConfig] ..> [JwtAuthFilter] : uses
[JWTService] ..> [AuditService] : uses
[JWTService] ..> [TokenBlacklistService] : uses
[EmailService] ..> [NotificationService] : uses
[UserRepository] ..> [Database] : reads/writes

@enduml
....

=== External System Connections and Integrations

The Identity Provider Application integrates with the following external systems:
- **Email System**: For sending out emails through the `EmailService`.
- **Notification System**: Used by `NotificationService` for notifying users.

=== Component Interaction Overview

Components interact primarily through Spring-managed services. `UserController` handles incoming HTTP requests and interacts with `UserService` for user management operations. `UserService` performs data persistence through `UserRepository` and utilizes `EmailService` and `AuditService` for emailing and auditing respectively.

=== Technology Stack and Frameworks Used

- **Spring Boot**: Framework for creating stand-alone, production-grade Spring based applications.
- **Spring Security**: For authentication and authorization.
- **JWT**: For secure transmission of information between parties as a JSON object.
- **Hibernate**: For ORM-based database operations.
- **MySQL**: As a database.
- **Maven**: Dependency management.

== 2. Component Description

=== IdentityproviderApplication

**Responsibility**: Acts as the bootstrap class that runs the Spring Boot application.

**Role**: Entry point of the Spring Boot application.

=== UserController

**Responsibility**: Handles all user-related operations such as login and registration.

**Role**: Acts as a controller to manage HTTP request mappings for user operations.

**Interaction**: Interacts with `UserService` for executing business logic.

=== UserService

**Responsibility**: Manages all business logic related to user operations.

**Role**: Service layer that interacts with `UserRepository` to perform database operations.

**Interaction**: Uses `EmailService` for sending emails, `AuditService` for logging actions, and interacts with `UserRepository` for data persistence.

=== JWTService

**Responsibility**: Manages all operations related to JWT including token generation and validation.

**Role**: Service layer that ensures secure token management.

**Interaction**: Interacts with `AuditService` and `TokenBlacklistService` for auditing and token invalidation respectively.

=== SecurityConfig

**Responsibility**: Configuration for security aspects of the application, including authentication and authorization setups.

**Role**: Configures authentication manager and security filters.

**Interaction**: Utilizes `JwtAuthFilter` for securing endpoints.

== 3. Infrastructure Architecture

=== Deployment Architecture

The application is containerized using Docker, allowing it to be deployed on any Docker-compatible environment, including Kubernetes clusters for better scalability and management.

=== Database Architecture

The application uses MySQL as its database. Entities such as `Users`, `Client`, `Role`, and `Token` are mapped in the database using Hibernate ORM.

=== Security Architecture

Security is managed using Spring Security with JWT for stateless authentication. `SecurityConfig` sets up the security environment that integrates with `JwtAuthFilter` to manage authentication processes.

=== Network Architecture

The application is designed to be deployed within a secure VPC, with firewalls configured to allow only HTTPS traffic. Internal communication happens over secured channels.

== 4. System Context

=== External Systems and Their Interfaces

- **Email System**: Interfaced via SMTP protocol used by `EmailService`.
- **Notification System**: API-based integration from `NotificationService`.

=== Data Flow Between Systems

User data flows from `UserController` to `UserService` and then to `UserRepository` for persistence. Authentication data flows through `JwtAuthFilter` and is managed by `JWTService`.

=== Authentication and Authorization Flows at System Level

Authentication is managed using JWT tokens. `UserController` processes login requests and uses `JWTService` to create tokens. `JwtAuthFilter` validates each request using tokens.

This document provides a high-level overview intended for architects and senior developers to understand and evaluate the system design of the Identity Provider Application.