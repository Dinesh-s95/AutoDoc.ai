= Vehicle Management System Detailed Design Documentation

This document provides a comprehensive detailed design of the Vehicle Management System. It includes class-by-class analysis, runtime view diagrams, entity relationship diagrams, and detailed component interactions.

== 1. Class-by-Class Analysis

=== 1.1 Vehicle

The `Vehicle` class is an entity model representing a vehicle in the system. It is annotated with `@Entity` to indicate that it is a JPA entity and `@Table` to specify the table details in the database.

*Annotations:*
- `@Entity`: Specifies that the class is an entity.
- `@Id`: Marks a field as the primary key.
- `@NotBlank`, `@NotNull`: Validation constraints to ensure fields are not null or blank.
- `@Table`: Specifies the table name for the entity if different from the class name.

*Methods:*
- Getters and setters for various fields like brand, country, device, model, sop (Start of Production), and vin (Vehicle Identification Number).

*Fields:*
- `brand : String`
- `country : String`
- `device : String`
- `model : String`
- `sop : LocalDate`
- `vin : String`

=== 1.2 VehiclemanagementApplication

The `VehiclemanagementApplication` class is the main class that bootstraps the Spring Boot application.

*Annotations:*
- `@SpringBootApplication`: Indicates a configuration class that declares one or more `@Bean` methods and also triggers auto-configuration and component scanning.

*Methods:*
- `main(String[] args)`: The main method that Spring Boot uses to start the application.

=== 1.3 VehicleController

The `VehicleController` class manages all web requests related to vehicles. It is a REST controller that handles HTTP requests.

*Annotations:*
- `@RestController`: Marks the class as a controller where every method returns a domain object instead of a view.
- `@RequestMapping`: Maps HTTP requests to handler methods of MVC and REST controllers.
- `@Autowired`: Marks a field for dependency injection.
- `@GetMapping`, `@PostMapping`: Specific HTTP method mappings.
- `@RequestBody`, `@Validated`: Method parameter annotations to indicate a parameter should be bound to the body of the web request and validated.

*Methods:*
- `registerVehicle(@RequestBody @Validated Vehicle vehicle)`: Registers a new vehicle.
- `verifyRegistration(@RequestParam final String vin, final String brand, final String country)`: Verifies the registration details of a vehicle.

*Fields:*
- `vehicleRepository : VehicleRepository`

=== 1.4 VehicleRepository

The `VehicleRepository` class is a repository interface for `Vehicle` entities, allowing for CRUD operations on the vehicle database.

*Annotations:*
- `@Repository`: Indicates that the class is a repository, which encapsulates the logic required to access data sources.

=== 1.5 VehiclemanagementApplicationTests

The `VehiclemanagementApplicationTests` class contains integration tests for the application.

*Annotations:*
- `@SpringBootTest`: Provides support for loading a Spring ApplicationContext and having beans `@Autowired` into your test instance.
- `@Test`: Indicates that the method is a test method.

== 2. Runtime View Diagrams

=== 2.1 User Registration Flow

[plantuml, user-registration-sequence, png]
----
@startuml
actor User
participant VehicleController
participant VehicleService
participant VehicleRepository

User -> VehicleController : registerVehicle(vehicle)
VehicleController -> VehicleService : validate(vehicle)
VehicleService -> VehicleRepository : save(vehicle)
VehicleRepository --> VehicleService : vehicleSaved
VehicleService --> VehicleController : vehicleRegistered
VehicleController --> User : registrationResponse
@enduml
----

=== 2.2 Authentication/Login Flow

[plantuml, authentication-sequence, png]
----
@startuml
actor User
participant AuthenticationController
participant AuthenticationService
participant UserRepository

User -> AuthenticationController : login(credentials)
AuthenticationController -> AuthenticationService : authenticate(credentials)
AuthenticationService -> UserRepository : findByUsername(username)
UserRepository --> AuthenticationService : user
AuthenticationService --> AuthenticationController : authenticationToken
AuthenticationController --> User : token
@enduml
----

=== 2.3 JWT Token Validation Flow

[plantuml, jwt-validation-sequence, png]
----
@startuml
actor User
participant ResourceController
participant JwtTokenProvider

User -> ResourceController : request(resource)
ResourceController -> JwtTokenProvider : validateToken(token)
JwtTokenProvider --> ResourceController : isValid
ResourceController --> User : response
@enduml
----

== 3. Entity Relationship Diagram

[plantuml, entity-relationship-diagram, png]
----
@startuml
entity "Vehicle" {
  * id : int
  --
  * brand : string
  * country : string
  * device : string
  * model : string
  * sop : LocalDate
  * vin : string
}
@enduml
----

== 4. Detailed Component Interactions

=== 4.1 Controller-Service-Repository Interactions

The interaction between the controller, service, and repository layers is crucial for handling business logic and data access.

*Controller:* Handles incoming HTTP requests, delegates business processing to the service layer, and returns the response.
*Service:* Contains business logic, interacts with the repository to retrieve or update data.
*Repository:* Interface to the database, executing CRUD operations directly on the database.

=== 4.2 Data Flow Through Layers

Data flows from the controller to the service where business logic is applied, then to the repository for database operations, and back the same route to the user.

=== 4.3 Exception Propagation

Exceptions are thrown by the repository or service layers and are propagated up to the controller where they are handled and an appropriate HTTP response is returned.

=== 4.4 Transaction Boundaries

Transactions are managed at the service layer, ensuring that database operations either complete entirely or rollback in case of an error, maintaining data integrity.

This document provides a detailed view of the Vehicle Management System, suitable for developers to understand and implement the design effectively.