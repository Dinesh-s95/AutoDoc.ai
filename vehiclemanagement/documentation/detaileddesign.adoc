= Vehicle Management System Detailed Design Document

== Introduction

This document provides a detailed design for the Vehicle Management System, developed using Java with Spring Boot. The system manages vehicle registrations and verifications through a RESTful API. The document includes class-by-class analysis, runtime view diagrams, entity relationship diagrams, and detailed component interactions.

== Class-by-Class Analysis

=== Vehicle

The `Vehicle` class is an entity model representing a vehicle in the system. It includes several fields such as brand, country, device, model, sop (start of production), and vin (vehicle identification number).

.Annotations:
* `@Entity`: Specifies that the class is an entity.
* `@Id`: Marks the `vin` field as the primary key.
* `@NotBlank`: Ensures fields are not blank.
* `@NotNull`: Ensures fields are not null.
* `@Table`: Specifies the table name if different from the class name.

.Methods:
* Getters and setters for each field.

=== VehiclemanagementApplication

This class contains the main method which boots up the Spring Boot application.

.Annotations:
* `@SpringBootApplication`: Indicates a configuration class that declares one or more `@Bean` methods and also triggers auto-configuration and component scanning.

.Methods:
* `main(String[] args)`: The entry point of the Spring Boot application.

=== VehicleController

This class handles all HTTP requests related to vehicles.

.Annotations:
* `@RestController`: Indicates that the data returned by each method will be written straight into the response body instead of rendering a template.
* `@RequestMapping`: Maps HTTP requests to handler methods of MVC and REST controllers.
* Other annotations like `@GetMapping` and `@PostMapping` map specific HTTP requests to specific methods.

.Methods:
* `verifyRegistration(String vin, String brand, String country)`: Verifies the registration details of a vehicle.
* `registerVehicle(Vehicle vehicle)`: Registers a new vehicle.

=== VehicleRepository

This interface extends `JpaRepository`, allowing basic CRUD operations on the `Vehicle` entity.

.Annotations:
* `@Repository`: Indicates that the class provides the mechanism for storage, retrieval, update, delete operation on objects.

=== VehiclemanagementApplicationTests

This class is used to test the Spring Boot application.

.Annotations:
* `@SpringBootTest`: Provides a bridge between Spring Boot test features and JUnit.
* `@Test`: Indicates that the method is a test method.

== Runtime View Diagrams

=== User Registration Flow

[plantuml, user-registration-sequence, png]
----
@startuml
actor User
participant "VehicleController" as Controller
participant "VehicleService" as Service
participant "VehicleRepository" as Repository

User -> Controller : registerVehicle(vehicle)
Controller -> Service : saveVehicle(vehicle)
Service -> Repository : save(vehicle)
Repository --> Service : vehicle
Service --> Controller : vehicle
Controller --> User : ResponseEntity(vehicle)
@enduml
----

=== Authentication/Login Flow

[plantuml, authentication-sequence, png]
----
@startuml
actor User
participant "AuthController" as Controller
participant "AuthService" as Service

User -> Controller : login(credentials)
Controller -> Service : authenticate(credentials)
Service -> Controller : token
Controller --> User : ResponseEntity(token)
@enduml
----

=== JWT Token Validation Flow

[plantuml, jwt-validation-sequence, png]
----
@startuml
actor User
participant "JWTFilter" as Filter
participant "AuthService" as Service

User -> Filter : API Request(token)
Filter -> Service : validateToken(token)
Service --> Filter : isValid
Filter --> User : Proceed / Error
@enduml
----

== Entity Relationship Diagram

[plantuml, entity-relationship-diagram, png]
----
@startuml
entity "Vehicle" {
  * vin : string
  --
  * brand : string
  * country : string
  * device : string
  * model : string
  * sop : LocalDate
}
@enduml
----

== Detailed Component Interactions

=== Controller-Service-Repository interactions

The `VehicleController` interacts with `VehicleService` to handle business logic, which in turn interacts with `VehicleRepository` for database operations. Data flows from the controller to the service and then to the repository. The service layer handles all business logic, including transaction management.

=== Exception Propagation

Exceptions are thrown from the repository or service layers and are caught in the controller where appropriate HTTP status codes are set.

=== Transaction Boundaries

Transactions are managed at the service layer, ensuring that database operations are completed successfully before committing the transaction.

== Conclusion

This document provides a comprehensive detailed design of the Vehicle Management System, suitable for developers to understand and implement the system effectively.